<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> React源码阅读系列 - §1.3 先给我整一个 Component · Jeremy's Note</title><meta name="description" content="React Component"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://jeremywu.info/atom.xml" title="Jeremy's Note"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/JeremyWuuuuu" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">React源码阅读系列 - §1.3 先给我整一个 Component</h1><div class="post-info">2018年7月20日</div><div class="post-content"><p><strong>关键字: </strong> <code>BaseComponent</code> <code>CustomComponent</code> <code>PureComponent</code> <code>Statelesscomponent</code></p>
<p>上回书说道, 所有人写的JSX(TSX)代码, 都会被对应的编译器给翻译成<code>React.createElement</code>形式的代码.<br>那么, 一个<code>CustomdComponent</code>是怎么样被React渲染的呢?</p>
<h4 id="来整懂嘛是一个ReactComponent"><a href="#来整懂嘛是一个ReactComponent" class="headerlink" title="来整懂嘛是一个ReactComponent"></a>来整懂嘛是一个ReactComponent</h4><a id="more"></a>
<hr>
<p>在开始之前, 先要公布一下<a href="/2018/07/18/React源码阅读系列-§1.2先有节点后有天%20ReactCreateElement/">上一篇</a>文章的练习题答案.</p>
<p>编译后代码如下:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">render = <span class="function"><span class="params">()</span> =&gt;</span> React.createElement(</span><br><span class="line">                      <span class="string">'div'</span>, <span class="comment">// type</span></span><br><span class="line">                      &#123;<span class="attr">className</span>: <span class="string">'container'</span>&#125;, <span class="comment">// props</span></span><br><span class="line">                      React.createElement(            <span class="comment">//  - |</span></span><br><span class="line">                        <span class="string">'span'</span>,   <span class="comment">//type              //    |--&gt; children</span></span><br><span class="line">                        &#123;<span class="attr">className</span>: <span class="string">'sub'</span>&#125;, <span class="comment">// props  //  - |</span></span><br><span class="line">                        <span class="literal">null</span>) <span class="comment">// children</span></span><br><span class="line">                      );</span><br></pre></td></tr></table></figure></p>
<p>上面的方法运行出来的结果为: </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  $$<span class="keyword">typeof</span>: <span class="built_in">Symbol</span>.for(<span class="string">'react.element'</span>)</span><br><span class="line">  type: <span class="string">'div'</span>,</span><br><span class="line">  key: <span class="literal">null</span>,</span><br><span class="line">  ref: <span class="literal">null</span>,</span><br><span class="line">  props: &#123;</span><br><span class="line">    className: <span class="string">'container'</span>,</span><br><span class="line">    children: &#123;</span><br><span class="line">      $$<span class="keyword">typeof</span>: <span class="built_in">Symbol</span>.for(<span class="string">'react.element'</span>)</span><br><span class="line">      type: <span class="string">'span'</span>,</span><br><span class="line">      key: <span class="literal">null</span>,</span><br><span class="line">      ref: <span class="literal">null</span>,</span><br><span class="line">      props: &#123;</span><br><span class="line">        className: <span class="string">'sub'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      _owner: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  _owner: <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>&emsp;&emsp;&nbsp;在<strong>ES6</strong> A.K.A. <a href="https://www.ecma-international.org/ecma-262/6.0/" target="_blank" rel="noopener">ECMAScript2015®</a>以及更高版本的<a href="https://www.ecma-international.org/publications/standards/Ecma-262.htm" target="_blank" rel="noopener">ECMAScript®</a>越来越普及的今天, 并且各种超集(Superset)/下一代编译器(Next Gen Compiler)如: <a href="https://www.typescriptlang.org/" target="_blank" rel="noopener">Typescript®</a>, <a href="http://babeljs.io/" target="_blank" rel="noopener">Babel®</a>的普及, 我们更多的是利用<code>class</code>语法来定义我们的<code>ReactComponent</code>, 而非早期版本的<code>React.createClass</code>, 且<code>React.createClass</code>在16.0+版本就已经被宣布废弃, 所以在这边就只对官方提供的三种Component:<br>&emsp;&emsp;&nbsp;&nbsp;i. <code>Component</code> 也叫 <code>BaseComponent</code><br>&emsp;&emsp;&nbsp;ii. <code>PureComponent</code><br>&emsp;&emsp;iii. <code>StatelessComponent</code> 也叫 <code>FunctionalComponent</code><br>做一个简单的分析.</p>
<h4 id="i-BaseComponent"><a href="#i-BaseComponent" class="headerlink" title="i. BaseComponent"></a>i. BaseComponent</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ReactComponent</span>(<span class="params">props, context, updater</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.props = props;</span><br><span class="line">  <span class="keyword">this</span>.context = context;</span><br><span class="line">  <span class="keyword">this</span>.refs = emptyObject;</span><br><span class="line">  <span class="keyword">this</span>.updater = updater || ReactNoopUpdateQueue;</span><br><span class="line">&#125;</span><br><span class="line">ReactComponent.prototype.isReactComponent = &#123;&#125;;</span><br><span class="line">ReactComponent.prototype.setState = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;; <span class="comment">// ...省略实现, 后面会专门讲这个方法</span></span><br><span class="line">ReactComponent.prototype.forceUpdate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;; <span class="comment">//.. 同上</span></span><br></pre></td></tr></table></figure>
<h4 id="ii-PureComponent"><a href="#ii-PureComponent" class="headerlink" title="ii. PureComponent"></a>ii. PureComponent</h4><p><code>PureComponent</code>其实基本上跟<code>ReactComponent</code>等价, 唯一不同的地方在这段代码, 而不同点将会在后面的文章当中对其进行介绍.<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReactPureComponent.prototype.isPureReactComponent = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure></p>
<h4 id="iii-StatelessComponent"><a href="#iii-StatelessComponent" class="headerlink" title="iii. StatelessComponent"></a>iii. StatelessComponent</h4><p><code>StatelessComponent</code>较前两者而言由于不提供任何的生命周期函数, 在特定情况下的性能也许会比前两者稍微好一点. 其更大的优势是在于, 简化了<code>Component</code>本身的一个抽象过程, 可以减少非常多的代码量.</p>
<p>以上是React系统中用户可自定义的三种<code>Component</code>. 这三者其实并没有实际定义所谓的生命周期等函数. 详情请见下回分解.</p>
<hr>
<h4 id="下期预告-ReactCompositeComponent"><a href="#下期预告-ReactCompositeComponent" class="headerlink" title="下期预告: ReactCompositeComponent"></a>下期预告: <code>ReactCompositeComponent</code></h4></div></article></div></main><footer><div class="paginator"><a href="/2018/07/21/React源码阅读系列-§1-4-来人-给我new一下/" class="prev">上一篇</a><a href="/2018/07/18/React源码阅读系列-§1.2先有节点后有天 ReactCreateElement/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'jeremywuuuuu';
var disqus_identifier = '2018/07/20/React源码阅读系列-§1.3先给我整一个Component/';
var disqus_title = 'React源码阅读系列 - §1.3 先给我整一个 Component';
var disqus_url = 'https://jeremywu.info/2018/07/20/React源码阅读系列-§1.3先给我整一个Component/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//jeremywuuuuu.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2018 <a href="https://jeremywu.info">Jeremy Wu</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>