{"pages":[],"posts":[{"title":"0b0001ä»åˆ†ç‰‡è°ƒåº¦æ¥çœ‹Reactçš„è°ƒåº¦æœºåˆ¶","text":"å…³é”®å­—: React Reconciler Scheduler åˆ†æ°´å²­ React v16React 16 ä¸ä¹‹å‰çš„ç‰ˆæœ¬æœ€å¤§çš„ä¸åŒå°±åœ¨äº React å¼€å‘æ ¸å¿ƒå›¢é˜Ÿé‡å†™äº† React ä¸­ç›¸å½“æ ¸å¿ƒçš„ä¸€éƒ¨åˆ†: æ›´æ–°ç­–ç•¥ Before v16Javascript ä¸æ¸²æŸ“å¼•æ“çš„å…³ç³»å› ä¸º Javascript è¯­è¨€çš„å¹¶å‘æ¨¡å‹çš„ç‰¹æ®Šæ€§, Javascript çš„ä»£ç è¢«æ”¾å…¥æ‰§è¡Œä¹‹å, å°±ä¼šä¸€ç›´è·‘åˆ°ç»“æŸ123while (true) { // do something} è¿™æ ·çš„ä»£ç ä¼šç›´æ¥å¯¼è‡´æµè§ˆå™¨æ²¡æœ‰å“åº” (ä¸è¦éšæ„å°è¯•). ç”±äºæ‰§è¡Œ Javascript å’Œæµè§ˆå™¨é¡µé¢å†…å®¹æ›´æ–°è®¡ç®—éƒ½æ˜¯å‘ç”Ÿåœ¨ä¸»çº¿ç¨‹ (Main Thread), å½“ Javascript è¢«æ‰§è¡Œå®Œ, ä¼šç”Ÿæˆæ–°çš„ æ¸²æŸ“æ ‘, æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹å›¾ Fig.1 å¸§æ›´æ–° (å›¾ç‰‡æ¥è‡ªäº Google Developers) ä¸€èˆ¬æ¥è®², è¿™å‡ ä¸ªæµç¨‹ä¸­çš„å‰ä¸‰ä¸ªè¿‡ç¨‹éƒ½æ˜¯å‘ç”Ÿåœ¨ CPU ä¸­, ä¹Ÿå°±æ˜¯æ‰€è°“çš„ Main Thread ä¸­, å‰©ä¸‹ä¸¤ä¸ªè¿‡ç¨‹æ˜¯å°†è®¡ç®—ç»“æœäº¤ç”± GPU æ¥æ‰§è¡Œ. å…¶ä¸­, ç¬¬ä¸‰æ­¥ layout ä¹Ÿæ˜¯å¯ä»¥è·³è¿‡çš„, å…·ä½“çš„ä¼˜åŒ–æ­¥éª¤å¯ä»¥å‚è§æ¸²æŸ“æ€§èƒ½ä¼˜åŒ– React çš„æ›´æ–°è°ƒåº¦ç­–ç•¥React åœ¨ v16 ä¹‹å‰çš„æ›´æ–°è°ƒåº¦ç­–ç•¥æ˜¯, æ¯å½“æœ‰æ›´æ–°å‘ç”Ÿ, ä¾¿ä¼šä»å¯åŠ¨æœ¬æ¬¡æ›´æ–°çš„èŠ‚ç‚¹å¼€å§‹, ä¸€ç›´å¾€ä¸‹è®¡ç®—èŠ‚ç‚¹çš„å˜æ›´, ç›´åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹è¢«è®¡ç®—å®Œ (è¿™æ˜¯ä¸€ä¸ªé€’å½’è¿‡ç¨‹), æ‰ä¼šæ ¹æ®è®¡ç®—å‡ºçš„æ–° v-dom æ ‘å»ä¸æ—§æ ‘æ¯”è¾ƒè¿›è¡Œä¸€è½®æ‰¹é‡æ›´æ–°, ç„¶åè¯¥æ¬¡æ›´æ–°å®Œæ¯•å, æ–°çš„æ¸²æŸ“æ ‘è¢«ç”Ÿæˆ, æœ€ç»ˆè¢«ç”»åœ¨äº†å±å¹•ä¸Š. è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º, è¿™ä¸ªæ›´æ–°è°ƒåº¦ç­–ç•¥è¢«å¤§å®¶ç§°ä¸º æ ˆè°ƒåº¦ (stack reconciler) Fig.2 React æ›´æ–°æµç¨‹ ç”±äºäººçœ¼å¯¹äºåŠ¨ç”»çš„æ„ŸçŸ¥å¿…é¡»æ˜¯åœ¨ 60 fps ä¸‹æ‰ä¸ä¼šæ„Ÿè§‰åˆ°æœ‰å¡é¡¿, ä¹Ÿå°±æ˜¯è¯´æ¯ä¸€å¸§(ç”»é¢)æ›´æ–°çš„æ—¶é—´ä»…æœ‰ 1000ms / 60 = ~16ms å·¦å³, å¦‚æœæ›´æ–°å‘¨æœŸå†…æµè§ˆå™¨ä¸»çº¿ç¨‹å¹¶æ²¡æœ‰æ—¶é—´æ¥æ›´æ–°ç”»é¢, ä¾¿ä¼šäº§ç”ŸæŠ›å¼ƒå¸§ (frame drop), ä¹Ÿå°±æ˜¯è¯´, å½“æŠ›å¼ƒå¸§å‘ç”Ÿæ—¶, ç”¨æˆ·çœ‹åˆ°çš„åŠ¨ç”»ä¼šçªç„¶ä»ä¸€ä¸ªä½ç½®é£åˆ°å¦ä¸€ä¸ªä½ç½®, é€ æˆå¡é¡¿(jank).æ­£æ˜¯ç”±äº Javascript çš„ç‰¹æ®Šæ€§, å¦‚æœå½“å‰æ›´æ–°çš„èŠ‚ç‚¹è¾ƒå¤š (äº¦æˆ–æ˜¯è®¡ç®—è¶³å¤Ÿå¤æ‚æ¶ˆè€— CPU), é‚£ä¹ˆå³ä½¿ React æœ¬èº«æœ‰ç€è¶³å¤Ÿä¼˜è¶Šçš„æ€§èƒ½, ä¹Ÿæ²¡æœ‰åŠæ³•é¿å…æŠ›å¼ƒå¸§çš„å‘ç”Ÿ, ä¸€æ—¦æ›´æ–°ä»»åŠ¡è€—æ—¶å¤ªä¹…, æˆ–è€…è®¡ç®—éå¸¸å¤æ‚, ä¸»çº¿ç¨‹å°±ä¼šè¢«é˜»å¡, è¿™æ ·ä¸€æ¥, ç”¨æˆ·çš„äº¤äº’ä¹Ÿæ²¡æœ‰åŠæ³•å¾—åˆ°å“åº” (å¦‚: é€‰æ‹©, è¾“å…¥ç­‰).\bæ­£å› å¦‚æ­¤, React æ ¸å¿ƒå›¢é˜Ÿå†³å®šé‡æ„ React çš„æ›´æ–°è°ƒåº¦ç­–ç•¥â€¦ After v16React Fiberå¾—ç›Šäº React ä¸­çš„ v-dom, React çš„æ€§èƒ½ååˆ†å‡ºè‰², ä½†ç”±äºç”¨æˆ·ä»£ç å¯¹äº React æ¥è¯´å®åœ¨æ˜¯å¤ªä¸å¯æ§, å¹¶ä¸” React ä¹Ÿå®åœ¨æ˜¯æ²¡æœ‰åŠæ³•èƒ½å¤Ÿå»å¼ºåˆ¶è§„å®šä½¿ç”¨è€…çš„ä»£ç é£æ ¼(è´¨é‡), äºæ˜¯ React çš„æ ¸å¿ƒå›¢é˜Ÿå†³å®šè®© React æ›´å¿«, å¹¶ä¸”ä¸ä¼šå› ä¸ºæ›´æ–°ä»»åŠ¡è¿‡äºç¹é‡ä»è€Œé€ æˆä¸»çº¿ç¨‹æ— å“åº”. æ‰€ä»¥ Fiber è¢«å¼•è¿›äº† Fiber æ˜¯ä¸€ç§ç¼–ç¨‹æ€æƒ³, æ˜¯ä¸€ç§éæŠ¢å å¼çš„å¤šçº¿ç¨‹æ¨¡å‹, å’Œ CoRoutine æ˜¯åŒä¸€ä¸ªæ¦‚å¿µ React Fiber ä¸­çš„æ¦‚å¿µæ˜¯, React Fiber ä¼šä¸»åŠ¨é€€å‡ºæ›´æ–°ä»»åŠ¡çš„è¿è¡Œ, ä»è€Œäº¤è¿˜ç»™æµè§ˆå™¨å»åšæ›´æ–°æ“ä½œ, å½“æµè§ˆå™¨æ“ä½œç»“æŸå, ä¼šä¸»åŠ¨å°†æ§åˆ¶æƒè¿”è¿˜ç»™ React Fiber, è¿›è€Œç»§ç»­æ›´æ–°å·¥ä½œ. React Fiber çš„è°ƒåº¦å™¨æ˜¯é€šè¿‡ requestAnimationFrame å’Œ setTimeout æ¥å®ç°çš„. Made with â¤ï¸ by Lin Clark at ReactConf 2017 PhaseFiber å°†æ›´æ–°åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ Computationè¿™ä¸ªé˜¶æ®µæ˜¯ React è®¡ç®—å“ªäº›åœ°æ–¹éœ€è¦æ›´æ–°çš„é˜¶æ®µ, è¿™ä¸ªé˜¶æ®µæ˜¯å¯ä»¥è¢«æ‰“æ–­çš„é˜¶æ®µ, ä¹Ÿå°±æ˜¯è¯´, åœ¨è¿™ä¸ªé˜¶æ®µ, React æ›´æ–°æ¯è¿è¡Œä¸€å°æ®µæ—¶é—´, å°±ä¼šå°†æ§åˆ¶æƒäº¤è¿˜ç»™æµè§ˆå™¨å»å“åº”äº¤äº’æˆ–æ›´æ–°, ç„¶åå†ç©ºé—²æ—¶é—´å›åˆ°å½“å‰çš„æ›´æ–°é˜¶æ®µ, ä½†æ˜¯, ç”±äºè·Ÿå“åº”ç”¨æˆ·äº¤äº’æ—¶, å¯èƒ½ä¼šæœ‰æ–°çš„æ›´æ–°æ’å…¥, äºæ˜¯ä¹‹å‰è®¡ç®—è¿‡çš„é‚£äº›è®¡ç®—ç»“æœå¯èƒ½å°±æ²¡æœ‰åŠæ³•ä½¿ç”¨äº†, ä¹‹å‰çš„è®¡ç®—ç»“æœå°±ä¼šè¢«æŠ›å¼ƒ, é‡æ–°è¿›è¡Œè®¡ç®—. å¹¶ä¸”, åœ¨è¿™äº›çš„åŸºç¡€ä¹‹ä¸Š, æ›´æ–°çš„æ“ä½œä¹Ÿæ˜¯æœ‰ç€ä¼˜å…ˆçº§ä¹‹åˆ†çš„, ä¼˜å…ˆçº§é«˜çš„æ›´æ–°ä¼˜å…ˆè¢«è®¡ç®—, ä¼˜å…ˆçº§ä½çš„å¿…é¡»ç­‰ä¼˜å…ˆçº§é«˜çš„è¢«è®¡ç®—å®Œä¹‹åæ‰èƒ½è¢«è®¡ç®—.è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ componentWillMount, UNSTABLE_componentWillUpdate ä¼šè¢«å¤šæ¬¡è°ƒç”¨çš„åŸå› . Commitè¿™ä¸ªé˜¶æ®µæ˜¯å®é™…è§¦å‘ DOM æ›´æ–°çš„é˜¶æ®µ, å¹¶ä¸”è¯¥é˜¶æ®µä¸ä¼šè¢«æ‰“æ–­, ä¹Ÿå°±æ˜¯è¯´, ä¸€æ—¦è¿›å…¥è¿™ä¸ªé˜¶æ®µ, æ›´æ–°å°±ä¼šè¢«å…¨éƒ¨å®Œæˆ, æµè§ˆå™¨åœ¨æ”¶åˆ°æ›´æ–°çš„é€šçŸ¥ä¹‹åä¾¿ä¼šå»æ›´æ–°é¡µé¢. Problemç»å†è¿™ä¸¤ä¸ªé˜¶æ®µ, ä¸€æ¬¡æ›´æ–°ä¹Ÿå°±ç®—å®Œæˆäº†, ä½†ç”±äºé˜¶æ®µä¸€å­˜åœ¨ä¼˜å…ˆçº§, ä¸€ä¸ªæ–°çš„é—®é¢˜åˆè¢«å¼•å…¥äº†, é‚£å°±æ˜¯ Starving Task, \bè¿™æ˜¯ç”±äºå¦‚æœä¸€ç›´æœ‰ä¼˜å…ˆçº§é«˜çš„æ›´æ–°æ’å…¥é˜Ÿåˆ—ä¸­, é‚£ä¹ˆä¼˜å…ˆçº§ä½çš„æ›´æ–°å°±æ°¸è¿œæ— æ³•è¢«è§¦å‘, å°±ä¼šå¼•èµ·ä¸€ç³»åˆ—çš„é—®é¢˜. UpComing...React Fiber è°ƒåº¦å™¨çš„å®ç°","link":"/2019/03/31/0b0001ä»åˆ†ç‰‡è°ƒåº¦æ¥çœ‹Reactçš„è°ƒåº¦æœºåˆ¶/"},{"title":"Reactæºç é˜…è¯»ç³»åˆ— - Â§0 ç®€ä»‹ Intro","text":"å…³é”®è¯: React æºç åˆ†æ React æºç é˜…è¯»&emsp;&emsp;&nbsp;æœ€è¿‘ç”±äºå·¥ä½œå˜åŠ¨, è¢«è°ƒåˆ°äº†æ–°çš„éƒ¨é—¨, æ–°çš„éƒ¨é—¨é‡Œçš„å¾ˆå¤šä»£ç å¹¶ä¸ç†Ÿæ‚‰, ä¾¿åªèƒ½ç¡¬ç€å¤´çš®çœ‹ä¸‹å», éšå³å‘ç°äº†ä¸€ä¸ªé—®é¢˜, è·³å‡ºèˆ’é€‚åœˆçš„æˆ‘, åœ¨çœ‹ä»£ç çš„è¿‡ç¨‹ä¸­, å­¦åˆ°äº†éå¸¸å¤šçš„ä¸œè¥¿, æƒ³è¦æƒ³åŠæ³•è¯æ˜è‡ªå·±, äºæ˜¯ä¾¿æƒ³å¼€è¿™ä¹ˆä¸€ç¯‡Reactçš„æºç é˜…è¯»çš„å‘, å‡†å¤‡èŠ±ä¸€æ®µæ—¶é—´æ¥é˜…è¯»ä»¥åŠè®°å½•è‡ªå·±å¯¹æºç é˜…è¯»åçš„ç†è§£å’Œæ„Ÿæ‚Ÿ. Reactç‰ˆæœ¬1234{ \"Name\": \"React\", \"Version\": \"15.6.2\"} æ ¸å¿ƒæ¦‚å¿µ (Core Concepts):0. åŸºç¡€éƒ¨åˆ† (Pre-requirement) ç”Ÿå‘½å‘¨æœŸ ä» JSX (TSX) åˆ° JS 1. å¯åŠ¨éƒ¨åˆ† (åœ¨åº”ç”¨å¯åŠ¨æ—¶çš„ä»£ç åˆ†æ) ä»ç»„ä»¶ (Component) åˆ° è™šæ‹ŸèŠ‚ç‚¹ (Virtual Node) ä»è™šæ‹ŸèŠ‚ç‚¹ (Virtual Node) åˆ° çœŸå®DOMèŠ‚ç‚¹ (Actual Node) 2. å­˜åœ¨å‘¨æœŸ (åœ¨å­˜åœ¨å‘¨æœŸæ—¶çš„ä»£ç åˆ†æ) äº‹ä»¶æœºåˆ¶ (Event Handling) äº‹åŠ¡å¤„ç† (Transaction Operation) æ›´æ–°æ“ä½œ (Updating Action)i. æ•°æ®æ›´æ–° (Data Updating)ii. è§†å›¾æ›´æ–° (Layout Updating) ç»„ä»¶é—´çš„é€šä¿¡ (Component Communication) Diffçš„ç®—æ³•åˆ†æ (Diff Algorithm) 3. æ€»ç»“","link":"/2018/07/16/Reactæºç é˜…è¯»ç³»åˆ—-Â§0 ç®€ä»‹ Intro/"},{"title":"Reactæºç é˜…è¯»ç³»åˆ— - Â§1.1 ç”Ÿå‘½å‘¨æœŸ Life cycle","text":"å…³é”®è¯: Lifecycle ç”Ÿå‘½å‘¨æœŸ Reactçš„ç”Ÿå‘½å‘¨æœŸ&emsp;&emsp;&nbsp;æ¯ä¸€ä¸ªè½¯ä»¶éƒ½æœ‰ä»–çš„ç”Ÿå‘½å‘¨æœŸ, Reactä¹Ÿä¸ä¾‹å¤–, ä»Reactçš„Tutorialå°±å¼€å§‹å‘æ¯ä¸€ä¸ªç”¨æˆ·ä»‹ç»Reactçš„ç”Ÿå‘½å‘¨æœŸ, Reactçš„å„ç§å†…åµŒé’©å­å‡½æ•°çš„ä½¿ç”¨. ä¸‹é¢æ¥è¯¦ç»†ä»‹ç»ä¸€ä¸‹Reactçš„ç”Ÿå‘½å‘¨æœŸåˆ°åº•æœ‰å“ªå‡ ä¸ªè¿‡ç¨‹. é€šè¿‡ä¸€å¼ å›¾æ¥ç†è§£: é€šè¿‡ä¸€æ®µæ³¨é‡Šæ¥ç†è§£:1234567891011121314151617181920212223242526/** * ------------------ The Life-Cycle of a Composite Component ------------------ * * - constructor: Initialization of state. The instance is now retained. * - componentWillMount * - render * - [children's constructors] * - [children's componentWillMount and render] * - [children's componentDidMount] * - componentDidMount * * Update Phases: * - componentWillReceiveProps (only called if parent updated) * - shouldComponentUpdate * - componentWillUpdate * - render * - [children's constructors or receive props phases] * - componentDidUpdate * * - componentWillUnmount * - [children's componentWillUnmount] * - [children destroyed] * - (destroyed): The instance is now blank, released by React and ready for GC. * * ----------------------------------------------------------------------------- */ æ³¨:i. è¯¥æ³¨é‡Šå‡ºå¤„ä¸ºReact æºç ä»“åº“ä¸­çš„ReactCompositeComponent.jsii. \b\bé€šè¿‡ç”¨æˆ·ç¼–å†™çš„Componentéƒ½æ˜¯ä¸€ä¸ªComposite Component ReactComponentç”Ÿå‘½å‘¨æœŸä»¥åŠæ‰€å¯¹åº”çš„é’©å­å‡½æ•°(Hook) Component åˆ›å»º:i. Component Constructor - åˆå§‹åŒ–State Propsii. ComponentWillMount - Hook APIiii. render - åˆ›å»ºèŠ‚ç‚¹iv. ComponentDidMount - Hook API Component æ›´æ–°i. ShouldComponentUpdate - Hook APIii. ComponentWillUpdate - Hook APIiii. render - æ›´æ–°èŠ‚ç‚¹iv. ComponentDidUpdate - Hook API Component é”€æ¯i. ComponentWillUnmount - Hook APIii. ç±»ä¼¼ someComponent = null; - ç­‰å¾…GC ä¸‹æœŸé¢„å‘Š: React.createElement","link":"/2018/07/17/Reactæºç é˜…è¯»ç³»åˆ—-Â§1.1-ç”Ÿå‘½å‘¨æœŸ-Lifecycle/"},{"title":"Reactæºç é˜…è¯»ç³»åˆ— - Â§1.2å…ˆæœ‰èŠ‚ç‚¹åæœ‰å¤© ReactCreateElement","text":"å…³é”®è¯: ReactElement JSX ä¸€åˆ‡éƒ½è¦ä»ReactDOM.renderè®²èµ·1234import * as React from 'react';import * as ReactDom from 'react-dom';import Example from 'example';ReactDOM.render(&lt;Example/&gt;, document.querySelector('#root')); ä»ä¸€ä¸ªé”™è¯¯è¯´èµ·ç›¸ä¿¡ä¸å°‘çš„äººéƒ½çŠ¯è¿‡è¿™æ ·ä¸€ä¸ªé”™è¯¯:123456789import { Component } from 'react';export default class SomeComponent extends Component { render() { return &lt;div&gt;Example&lt;/div&gt;; }}Error: React is not defined. \bæ˜æ˜æˆ‘è¿™é‡Œå¹¶æ²¡æœ‰ç”¨åˆ°Reactè¿™ä¸ªå…³é”®å­—ä¸ºä»€ä¹ˆä¼šå‘Šè¯‰æˆ‘è¯´React is not definedå‘¢? \b&emsp;&emsp;&nbsp;ç­”æ¡ˆå°±æ˜¯å½“ä½ å†™JSXçš„ä»£ç æ—¶, \béƒ½æ˜¯éœ€è¦é€šè¿‡æˆ‘ä»¬çš„ä¸€äº›ç¼–è¯‘å·¥å…·æŠŠJSXä»£ç ç¼–è¯‘æˆJavaScriptä»£ç , è¿™æ ·æµè§ˆå™¨æ‰èƒ½å¤Ÿè¿è¡Œ. è€Œè¿™é‡Œçš„ç¼–è¯‘è¿‡ç¨‹æ­£å¥½æ˜¯ç”¨åˆ°äº†Reactè¿™ä¸ªåº“ä¸Šæ‰€æä¾›çš„createElementæ–¹æ³•, æ‰€ä»¥æ‰ä¼šæœ‰ä¸Šé¢è¿™ä¸€è¡Œé”™è¯¯. ä¸Šé¢çš„ä»£ç ç­‰åŒäº: 1234567// ...çœç•¥class SomeComponent extends React.Component { render() { return React.createElement('div', null); }}// ...çœç•¥ å…·ä½“åˆ†æcreateElementæ–¹æ³•åˆ°åº•æ˜¯å¹²äº†ä»€ä¹ˆcreateElementæ–¹æ³•çš„æ–¹æ³•ç­¾å: 1function createElement(type, config, children); å‚æ•°å ç±»å‹ type string or ReactCompositeComponent config any children any è¿”å›å€¼ ReactElement ä»å‡½æ•°ç­¾åä¸Šå¯ä»¥ä¸éš¾çœ‹å‡º, åœ¨æ„é€ èŠ‚ç‚¹æ—¶, React æ˜¯éœ€è¦çŸ¥é“è¦æ„é€ çš„èŠ‚ç‚¹çš„ç±»å‹, èŠ‚ç‚¹éœ€è¦ç”¨åˆ°çš„ä¸€äº›å±æ€§å€¼, ä»¥åŠèŠ‚ç‚¹çš„å­èŠ‚ç‚¹, ç„¶åè¿”å›äº†ä¸€ä¸ªReactElementå®ä½“. æ³¨:&emsp;ä¸€ä¸ªå…ƒç´ èŠ‚ç‚¹ä¸Šçš„å­èŠ‚ç‚¹å¯ä»¥çœ‹åšè¯¥èŠ‚ç‚¹çš„å±æ€§å€¼(Property). æ¥ä¸‹æ¥è¿›å…¥æ–¹æ³•å†…éƒ¨, çœ‹è¿™ä¸ªæ–¹æ³•åˆ°åº•åšäº†ä¸€äº›ä»€ä¹ˆäº‹æƒ…, è¯¥æ–¹æ³•æœ€åè¿”å›çš„ç»“æœåˆæ˜¯ä»€ä¹ˆ, çœç•¥æ‰ä¸€éƒ¨åˆ†æ— å…³ç´§è¦çš„ä»£ç , æŸäº›ä»£ç æ ¼å¼ä¸ºäº†ç¯‡å¹…ç¨æœ‰æ•´æ”¹ä½†ä¸å½±å“æ­£ç¡®æ€§.123456789101112131415161718192021222324252627282930313233343536React.createElement = function(type, config, children) { var propName; var props = {}, key = ref = self = source = null; // ä¼ é€’å±æ€§ if (config != null) { // å…³é”®å±æ€§, åé¢ä¼šåˆ†æåˆ°. if (hasValidRef(config)) { ref = config.ref; } // åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦å…·æœ‰æœ‰æ•ˆçš„ç‰¹æ®Škey, keyå±æ€§ä¹Ÿæ˜¯èŠ‚ç‚¹çš„ä¿ç•™å±æ€§, ä¸ºReactçš„diffåšäº†éå¸¸å¤§çš„è´¡çŒ® if (hasValidKey(config)) { key = '' + config.key; } self = config.__self === undefined ? null : config.__self; source = config.__source === undefined ? null : config.__source; for (propName in config) { // ... çœç•¥å±æ€§çš„å¤åˆ¶ } } // æŠŠå­èŠ‚ç‚¹ä½œä¸ºå½“å‰æ ¹èŠ‚ç‚¹ä¸Šçš„å±æ€§ var childrenLength = arguments.length - 2; if (childrenLength === 1) { props.children = children; } else if (childrenLength &gt; 1) { // æ­¤å¤„ä»£ç ä¸ºæœ¬æ–‡ä½œè€…è°ƒæ•´ åŸå§‹ä»£ç å¯å‚è§æ–‡æœ«ç»™å‡ºåœ°å€ props.children = Array.prototype.slice.call(arguments, 2); } // å¤„ç†æ ¹èŠ‚ç‚¹ä¸Šçš„é»˜è®¤çš„å±æ€§ if (type &amp;&amp; type.defaultProps) { // ... çœç•¥é»˜è®¤å±æ€§çš„å¤åˆ¶ } // è¿”å›ä¸€ä¸ªReactElementèŠ‚ç‚¹ return ReactElement(type, key, ref, self, source, ReactCurrentOwner.current, props);} &emsp;&emsp;&nbsp;é€è¿‡è¿™ä¸ªæ–¹æ³•å…¶å®ä¸éš¾çœ‹å‡º, React.createElementæ•´ä¸ªæ–¹æ³•å†…éƒ¨, éƒ½æ˜¯åœ¨åšä¸€ç³»åˆ—çš„æ•°æ®å¤„ç†, ç„¶åæŠŠå¤„ç†å¥½çš„æ•°æ®è¾“å…¥ç»™ReactElementè¿™ä¸ªæ–¹æ³•, é€šè¿‡è¯¥æ–¹æ³•æ¥æ„é€ å‡ºä¸€ä¸ªçœŸæ­£çš„ReactElementèŠ‚ç‚¹. ReactElementåˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿?&emsp;&emsp;&nbsp;ä»ä¸Šé¢æœ€åä¸€è¡Œå¯ä»¥çœ‹å‡ºæ¥, æœ€åé€šè¿‡æ„é€ æ–¹æ³•è°ƒç”¨, è¿”å›äº†ä¸€ä¸ªçœŸå®çš„ReactElement, è¿™é‡Œå…¶å®å¯ä»¥çœ‹åšä¸€ä¸ªç±»å®ä¾‹æ„é€ ç±»ä¼¼ çœç•¥æ‰newæ“ä½œç¬¦çš„ç±»æ„é€ å™¨è°ƒç”¨\b. 1234567891011// ... è¿™ä¸ªmarkdownçš„æ”¯æŒå¯çœŸçƒ‚var ReactElement = function(type, key, ref, self, source, owner, props) { return { $$typeof: REACT_ELEMENT_TYPE, type, key, ref, props, _owner: owner };} \bå±æ€§å ç±»å‹ æè¿° $$typeof Symbol æ ‡è¯†è¯¥å¯¹è±¡æ˜¯ä¸€ä¸ªReactElement type any è¯¥Elementçš„ç±»å‹ key string æ ‡è¯†è¯¥èŠ‚ç‚¹çš„ç‹¬æœ‰key ref object or function è¯¥èŠ‚ç‚¹å¯¹è±¡çš„å¼•ç”¨ props object è¯¥èŠ‚ç‚¹çš„æ‰€æœ‰å±æ€§ _owner any æ ‡è¯†è¯¥èŠ‚ç‚¹çš„æ‰€æœ‰è€… æœ€åçš„å°æµ‹è¯•:å°è¯•äººä¸ºè°ƒç”¨ä¸Šè¿°çš„React.createElementæ–¹æ³•æ¥å¾—åˆ°ä¸€ä¸ªReactElementç„¶åç”¨æ ‘å½¢ç»“æ„è¡¨ç¤ºå‡ºæ¥, ç­”æ¡ˆåœ¨ä¸‹ä¸€ç« å¼€å¤´.123&lt;div class=\"container\"&gt; &lt;span class=\"sub\"&gt;Text Node&lt;/span&gt;&lt;/div&gt; ä¸‹æœŸé¢„å‘Š: ReactComponent","link":"/2018/07/18/Reactæºç é˜…è¯»ç³»åˆ—-Â§1.2å…ˆæœ‰èŠ‚ç‚¹åæœ‰å¤© ReactCreateElement/"},{"title":"Reactæºç é˜…è¯»ç³»åˆ— - Â§1.3 å…ˆç»™æˆ‘æ•´ä¸€ä¸ª Component","text":"å…³é”®å­—: BaseComponent CustomComponent PureComponent Statelesscomponent ä¸Šå›ä¹¦è¯´é“, æ‰€æœ‰äººå†™çš„JSX(TSX)ä»£ç , éƒ½ä¼šè¢«å¯¹åº”çš„ç¼–è¯‘å™¨ç»™ç¿»è¯‘æˆReact.createElementå½¢å¼çš„ä»£ç .é‚£ä¹ˆ, ä¸€ä¸ªCustomdComponentæ˜¯æ€ä¹ˆæ ·è¢«Reactæ¸²æŸ“çš„å‘¢? æ¥æ•´æ‡‚å˜›æ˜¯ä¸€ä¸ªReactComponent \b\båœ¨å¼€å§‹ä¹‹å‰, å…ˆè¦å…¬å¸ƒä¸€ä¸‹ä¸Šä¸€ç¯‡æ–‡ç« çš„ç»ƒä¹ é¢˜ç­”æ¡ˆ. ç¼–è¯‘åä»£ç å¦‚ä¸‹:12345678render = () =&gt; React.createElement( 'div', // type {className: 'container'}, // props React.createElement( // - | 'span', //type // |--&gt; children {className: 'sub'}, // props // - | null) // children ); ä¸Šé¢çš„æ–¹æ³•è¿è¡Œå‡ºæ¥çš„ç»“æœä¸º: 1234567891011121314151617181920{ $$typeof: Symbol.for('react.element') type: 'div', key: null, ref: null, props: { className: 'container', children: { $$typeof: Symbol.for('react.element') type: 'span', key: null, ref: null, props: { className: 'sub' }, _owner: null } }, _owner: null} &emsp;&emsp;&nbsp;åœ¨ES6 A.K.A. ECMAScript2015Â®ä»¥åŠæ›´é«˜ç‰ˆæœ¬çš„ECMAScriptÂ®è¶Šæ¥è¶Šæ™®åŠçš„ä»Šå¤©, å¹¶ä¸”å„ç§è¶…é›†(Superset)/ä¸‹ä¸€ä»£ç¼–è¯‘å™¨(Next Gen Compiler)å¦‚: TypescriptÂ®, BabelÂ®çš„æ™®åŠ, æˆ‘ä»¬æ›´å¤šçš„æ˜¯åˆ©ç”¨classè¯­æ³•æ¥å®šä¹‰æˆ‘ä»¬çš„ReactComponent, \b\bè€Œéæ—©æœŸç‰ˆæœ¬çš„React.createClass, ä¸”React.createClassåœ¨16.0+ç‰ˆæœ¬å°±å·²ç»è¢«å®£å¸ƒåºŸå¼ƒ, æ‰€ä»¥åœ¨è¿™è¾¹å°±åªå¯¹å®˜æ–¹æä¾›çš„ä¸‰ç§Component:&emsp;&emsp;&nbsp;&nbsp;i. Component ä¹Ÿå« BaseComponent&emsp;&emsp;&nbsp;ii. PureComponent&emsp;&emsp;iii. StatelessComponent ä¹Ÿå« FunctionalComponentåšä¸€ä¸ªç®€å•çš„åˆ†æ. i. \bBaseComponent123456789function ReactComponent(props, context, updater) { this.props = props; this.context = context; this.refs = emptyObject; this.updater = updater || ReactNoopUpdateQueue;}ReactComponent.prototype.isReactComponent = {};ReactComponent.prototype.setState = function () {}; // ...çœç•¥å®ç°, åé¢ä¼šä¸“é—¨è®²è¿™ä¸ªæ–¹æ³•ReactComponent.prototype.forceUpdate = function() {}; //.. åŒä¸Š ii. PureComponentPureComponentå…¶å®åŸºæœ¬ä¸Šè·ŸReactComponentç­‰ä»·, å”¯ä¸€ä¸åŒçš„åœ°æ–¹åœ¨è¿™æ®µä»£ç , è€Œä¸åŒç‚¹å°†ä¼šåœ¨åé¢çš„æ–‡ç« å½“ä¸­å¯¹å…¶è¿›è¡Œä»‹ç».1ReactPureComponent.prototype.isPureReactComponent = true; iii. StatelessComponentStatelessComponentè¾ƒå‰ä¸¤è€…è€Œè¨€ç”±äºä¸æä¾›ä»»ä½•çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°, åœ¨ç‰¹å®šæƒ…å†µä¸‹çš„æ€§èƒ½ä¹Ÿè®¸ä¼šæ¯”å‰ä¸¤è€…ç¨å¾®å¥½ä¸€ç‚¹. å…¶æ›´å¤§çš„ä¼˜åŠ¿æ˜¯åœ¨äº, ç®€åŒ–äº†Componentæœ¬èº«çš„ä¸€ä¸ªæŠ½è±¡è¿‡ç¨‹, å¯ä»¥å‡å°‘éå¸¸å¤šçš„ä»£ç é‡. ä»¥ä¸Šæ˜¯Reactç³»ç»Ÿä¸­ç”¨æˆ·å¯è‡ªå®šä¹‰çš„ä¸‰ç§Component. è¿™ä¸‰è€…å…¶å®å¹¶æ²¡æœ‰å®é™…å®šä¹‰æ‰€è°“çš„ç”Ÿå‘½å‘¨æœŸç­‰å‡½æ•°. è¯¦æƒ…è¯·è§ä¸‹å›åˆ†è§£. ä¸‹æœŸé¢„å‘Š: ReactCompositeComponent","link":"/2018/07/20/Reactæºç é˜…è¯»ç³»åˆ—-Â§1.3å…ˆç»™æˆ‘æ•´ä¸€ä¸ªComponent/"},{"title":"Reactæºç é˜…è¯»ç³»åˆ—-Â§1.4-æ¥äºº, ç»™æˆ‘newä¸€ä¸‹","text":"å…³é”®å­—: ReactCompositeComponent instantiate è®©æˆ‘ä»¬å…ˆå®ä¾‹åŒ–ä¸€ä¸ªç»„ä»¶ä¸Šä¸€ç« è®²åˆ°äº†, Reactçš„Componentç§ç±», ä½†æ²¡è®²åˆ°ç”¨æˆ·è‡ªå·±å†™çš„CustomComponentæ˜¯æ€ä¹ˆè¢«å®ä¾‹åŒ–çš„. åœ¨åé¢çš„ç« èŠ‚ä¼šä»‹ç»åˆ°å…³äºåº”ç”¨å¯åŠ¨çš„è¿‡ç¨‹åˆ°åº•å‘ç”Ÿäº†å“ªäº›äº‹æƒ…, åœ¨è¿™è¾¹å°±å…ˆç®€å•çš„åšä¸€ä¸ªé“ºå«. ä¸»è¦å…³æ³¨åœ¨CustomComponentçš„å®ä¾‹åŒ–è¿‡ç¨‹. \b\bå½“æˆ‘ä»¬è°ƒç”¨React.render(...)æ–¹æ³•çš„æ—¶å€™, ä¼šè°ƒç”¨ReactMount.jsä¸­çš„instantiateReactComponentæ–¹æ³•, è¯¥æ–¹æ³•ä¸­æ¶‰åŠåˆ°å®ä¾‹åŒ–ä¸€ä¸ªCustomComponentçš„ä»£ç ä¸º:123456789101112131415161718function instantiateReactComponent(node, shouldHaveDebugID) { var instance; var element = node; if (typeof element.type === 'string') { instance = ReactHostComponent.createInternalComponent(element); } else if (isInternalComponentType(element.type)) { instance = new element.type(element); if (!instance.getHostNode) { instance.getHostNode = instance.getNativeNode; } } else { instance = new ReactCompositeComponentWrapper(element); } else if (typeof node === 'string' || typeof node === 'number') { instance = ReactHostComponent.createInstanceForText(node); } else { throw new Error(\"Encountered invalid React node of type \" + typeof node ); } } å…³é”®çš„ä¸€è¡Œä»£ç åœ¨æ­¤å¤„:1instance = new ReactCompositeComponentWrapper(element); å…³é”®è§’è‰²ReactCompositeComponentWrapperæ˜¯å¹²ä»€ä¹ˆçš„å‘¢? åˆå’Œæˆ‘ä»¬æåˆ°çš„ReactCompositeComponentæœ‰ä»€ä¹ˆçº ç¼ ä¸æ¸…çš„å…³ç³»å‘¢? ä¸‹é¢å‡ è¡Œä»£ç å°±å¯ä»¥å‘Šè¯‰ä½ äº‹æƒ…çš„çœŸç›¸:12345678910var ReactCompositeComponentWrapper = function(element) { this.construct(element);};Object.assign( ReactCompositeComponentWrapper.prototype, ReactCompositeComponent, { _instantiateReactComponent: instantiateReactComponent, },); ReactCompositeComponentWrapperå°±è·Ÿä»–çš„åå­—ä¸€æ ·, æ˜¯å¯¹ReactCompositeComponentè¿™ä¸ªç±»çš„ä¸€ä¸ªåŒ…è£…ç±», æ‰€æœ‰çš„ç±»æ–¹æ³•éƒ½æ¥è‡ªäºæˆ‘ä»¬ä»Šå¤©è¦è¯´åˆ°çš„ä¸»è§’ReactCompositeComponent. ReactCompositeComponent\bæºç åœ°å€: ReactCompositeComponent.js ä¸‹é¢æ¥ç€å¯¹ReactCompositeComponentåšä¸€ä¸‹åˆ†æ, æŸäº›æ–¹æ³•çš„å…·ä½“å†…å®¹ä¼šçœç•¥æ‰, å¦‚æœæœ‰éœ€è¦å¯ä»¥è‡ªè¡ŒæŸ¥é˜…æºç å½“ä¸­çš„å…·ä½“ä»£ç , æ–¹ä¾¿èŠ‚çœç¯‡å¹…ä»¥åŠæ›´æ˜“äºé˜…è¯».1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253var ReactCompositeComponent = { construct: function() {...}, // ç”¨äºåˆå§‹åŒ–ç»„ä»¶çš„å…ƒä¿¡æ¯(Metadata) mountComponent: function() { var inst = this._constructComponent(...); // ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„å¯åŠ¨å…¥å£, var markup; // renderæ–¹æ³•è¿”å›çš„ReactElementå°±æ˜¯è¿™ä¸ªmarkup markup = performInitialMount(...); if (inst.componentDidMount) inst.componentDidMount(); // ç¬¬ä¸‰ä¸ªé’©å­å‡½æ•°è°ƒç”¨ return markup; }, _constructComponent: function() {...}, // è¿™ä¸ªæ–¹æ³•ä¼šè°ƒç”¨ä¸‹é¢è¿™ä¸ªæ–¹æ³• _constructComponentWithoutOwner: function() { return new Component(publicProps, publicContext, updateQueue); // è¢«åŒ…èµ·æ¥çš„Componentè¢«å®ä¾‹åŒ– }, performInitialMount: function() { var ins = this._instance; if (ins.componentWillMount) ins.componentWillMount(); // ç¬¬ä¸€ä¸ªé’©å­å‡½æ•°çš„è°ƒç”¨ // æ¯”è¾ƒé‡è¦çš„åœ°æ–¹: å½“åœ¨åˆå§‹æŒ‚è½½çš„é˜¶æ®µå¦‚æœæœ‰å‘ç°`setState`æ–¹æ³•è¢«è°ƒç”¨, ä¾¿ä¼šé€šè¿‡åŒæ­¥çš„æ–¹å¼æ¥å¤„ç†, å¾ˆå¥½çš„é¿å…äº†setStateå¯¼è‡´çš„é‡æ–°æ¸²æŸ“, æ¥æé«˜æ•´ä½“çš„æ€§èƒ½. if (this._pendingStateQueue) { inst.state = this._processPendingState(inst.props, inst.context); } if (renderedElement === undefined) { // è¿‘ä¼¼ç­‰äº: renderedElement = this._instance.render(); renderedElement = this._renderValidatedComponent(); } var child = this._instantiateReactComponent(...) // é€’å½’å®ä¾‹åŒ–å­ç»„ä»¶ var markup = ReactReconciler.mountComponent(child, ...); // é€’å½’å¾—åˆ°å®Œæ•´çš„æ ‘. return markup; }, _renderValidatedComponent: function() { return this._renderValidatedComponentWithoutOwnerOrContext(); }, _renderValidatedComponentWithoutOwnerOrContext: function() { return this._instance.render(); // ç¬¬äºŒä¸ªé’©å­çš„è°ƒç”¨ }, receiveComponent: function(...) { // è°ƒç”¨è¯¥æ–¹æ³•æ¥æ›´æ–°Component this.updateComponent(...); }, updateComponent: function(...) { // åé¢ä¼šè®²åˆ°è¿™äº›æ›´æ–°æ¡ä»¶å¦‚ä½•è¢«æ»¡è¶³ if (willReceive &amp;&amp; inst.componentWillReceiveProps) { inst.componentWillReceiveProps(); // ç¬¬å››ä¸ªé’©å­å‡½æ•°çš„è°ƒç”¨ } var shouldUpdate = inst.shouldComponentUpdate(); // ç¬¬äº”ä¸ªé’©å­å‡½æ•°è°ƒç”¨ if (shouldUpdate) this._performComponentUpdate(); }, _performComponentUpdate: function() { inst.componentWillUpdate(...); // ç¬¬å…­ä¸ªé’©å­å‡½æ•°çš„è°ƒç”¨. this._updateRenderedComponent(...); // æ›´æ–°; å†…éƒ¨è°ƒç”¨ç¬¬ä¸ƒä¸ªé’©å­å‡½æ•° Component.render(); inst.componentDidUpdate &amp;&amp; inst.componentDidUpdate(); // ç¬¬å…«ä¸ªä¸ªé’©å­å‡½æ•°è°ƒç”¨ }, // é‡Œé¢æ˜¯Componentæ›´æ–°çš„æ“ä½œ ç®€å•æ¥è¯´å°±æ˜¯é”€æ¯æ‰åŸæœ‰çš„èŠ‚ç‚¹, ç„¶åé‡æ–°å®ä¾‹åŒ–æ–°çš„èŠ‚ç‚¹æŒ‚è½½. _updateRenderedComponent: function() { }, unmountComponent: function() { } // é€’å½’å¸è½½èŠ‚ç‚¹, è°ƒç”¨å­èŠ‚ç‚¹çš„ componentWillUnmountæ–¹æ³•} æœ¬ç« å°ç»“:ReactCompositeComponent çš„å†…å®¹åŸºæœ¬å°±æ˜¯æŒ‚è½½/æ›´æ–°/å¸è½½ç­‰æ“ä½œ. \bé™¤äº†CompositeComponent, åœ¨instantiateReactComponentæ–¹æ³•ä¸­, èƒ½å¤Ÿçœ‹åˆ°Reactä¸­ä¸€å…±æœ‰4ç§Componentç±»å‹. ReactCompositeComponent InternalComponent. // å¯ä»¥ç†è§£ä¸ºReactçš„å®˜æ–¹æ ‡å‡†ç»„ä»¶åº“ UserDefinedComponent // ç”¨æˆ·è‡ªå®šä¹‰ ReactDOMComponent // DOMèŠ‚ç‚¹ç›¸å…³çš„Component, è‡ªå®šä¹‰çš„Componentæœ€åéƒ½ä¼šè¢«å¤„ç†æˆè¯¥ç±»å‹çš„ ReactTextComponent // å­—é¢é‡èŠ‚ç‚¹, å¦‚ &quot;Some string&quot; &quot;12312&quot; ReactEmptyComponent // ç©ºèŠ‚ç‚¹ ä¸‹æœŸé¢„å‘Š: ä»React.render()çš„è°ƒç”¨å¼€å§‹, åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆ?","link":"/2018/07/21/Reactæºç é˜…è¯»ç³»åˆ—-Â§1.4-æ¥äºº-ç»™æˆ‘newä¸€ä¸‹/"},{"title":"Reactæºç é˜…è¯»ç³»åˆ—-Â§1.5-ReactDOM.renderå¹²äº†å•¥","text":"å…³é”®å­—: ReactDOM.render è°ƒç”¨æ ˆ Reactåº”ç”¨çš„å¯åŠ¨å¯è°“æ˜¯ç›¸å½“ç®€å•äº†, æ— éœ€è¿‡å¤šçš„é…ç½®, åªéœ€è¦ä¸‰è¡Œä»£ç ä¾¿å¯ä»¥å¯åŠ¨ 123import * as React from 'react';import {render} from 'react-dom';render((&lt;div&gt;å¯åŠ¨!&lt;/div&gt;), document.querySelector('#root')); ReactDOM.renderæ–¹æ³•ä¸€å…±æ¥å—ä¸‰ä¸ªå‚æ•°:1ReactDOM.render = function(nextElement, container, callback) {...}; ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºéœ€è¦æ¸²æŸ“çš„ReactElement;ç¬¬äºŒä¸ªå‚æ•°æ˜¯ç”¨æ¥æŒ‚è½½æ¸²æŸ“å¥½çš„DOMèŠ‚ç‚¹çš„Container;ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºä¸€ä¸ªå¯é€‰å‚æ•°,ç”¨æ¥æ¥å—ä¸€ä¸ªåœ¨è¯¥æ–¹æ³•ç»“æŸä¹‹åè¢«è°ƒç”¨çš„ä¸€ä¸ªFunction; ç»“åˆä¸Šä¸€äº›ä»£ç æ¥äº†è§£ä¸€ä¸‹, è¯¥æ–¹æ³•è¢«è°ƒç”¨æ—¶åˆ°åº•ç»è¿‡äº†å“ªä¸€äº›è¿‡ç¨‹. ReactDOM.render()çš„è°ƒç”¨æ ˆä¸ºäº†æ›´å¥½çš„èƒ½å¤Ÿç†è§£è¿™ä¸€ç« çš„å†…å®¹, ä¸Šä¸€ç¯‡å·²ç»é€šè¿‡äº†ReactCompositeComponentåšäº†ä¸€è½®é“ºå«, åœ¨æœ‰äº†ä¸Šä¸€ç¯‡çš„çŸ¥è¯†çš„åŸºç¡€ä¸Š, æœ¬ç¯‡å†…å®¹çš„å¤æ‚åº¦å°†ä¼šå¤§å¤§é™ä½. æ‰€æœ‰å†…å®¹å‡å»ºç«‹åœ¨æ²¡æœ‰å¯åŠ¨ServerSideRenderingçš„æƒ…å†µä¹‹ä¸‹. é€šè¿‡æ–‡å­—æ¥æè¿°: renderæ–¹æ³•é¦–å…ˆä¼šè°ƒç”¨_renderSubtreeIntoContaineræ¥å¯åŠ¨è°ƒç”¨è¿‡ç¨‹, è¯¥æ–¹æ³•ä¼šè°ƒç”¨_renderNewRootComponentæ–¹æ³•. å¹¶ä¸”ä¼šè°ƒç”¨renderä¼ å…¥çš„callbackæ–¹æ³•. _renderNewRootComponentä¼šè°ƒç”¨instantiateReactComponent()æ–¹æ³•æ¥å®ä¾‹åŒ–è¢«ä¼ å…¥çš„ç»„ä»¶. ç„¶åå¾—åˆ°å¯¹åº”çš„ç»„ä»¶æ ‘. æŠŠå¾—åˆ°çš„ç»„ä»¶æ ‘é€šè¿‡ReactUpdates.batchedUpdatesæ›´æ–°åˆ°DOMä¸­.i. ReactUpdates.batchedUpdatesä¼šé€šè¿‡è°ƒç”¨batchingStrategy.batchedUpdatesæ¥è°ƒç”¨batchedMountComponentIntoNodeæ–¹æ³•. è¿™é‡Œæœ‰å…³äºReactTransactionçš„æ¦‚å¿µ, åœ¨åé¢ä¸€ç« é‡Œé¢ä¼šè®²åˆ°.ii. è¿™è¾¹éœ€è¦å…³æ³¨çš„æ–¹æ³•å°±æ˜¯batchedMountComponentIntoNodeæ–¹æ³•. batchedMountComponentIntoNodeè°ƒç”¨mountComponentIntoNode, ç„¶åç´§æ¥ç€ReactReconciler.mountComponenè¢«è°ƒç”¨. åˆ°è¿™é‡Œå¼€å§‹å°±æ˜¯ä¸Šä¸€ç« è®²è¿‡çš„é‚£ä¸€éƒ¨åˆ†å†…å®¹äº†. å®ä¾‹å†…éƒ¨çš„ç”Ÿå‘½å‘¨æœŸè¢«è°ƒç”¨, ç„¶åè¿”å›äº†å¯¹åº”çš„DOMç»“æ„. è¿”å›çš„DOMç»“æ„è¢«é€šè¿‡ReactMount._mountImageIntoNodeæ–¹æ³•æŒ‚è½½è¿›å…¥çœŸæ­£çš„DOMä¸­. è‡³æ­¤, æ•´ä¸ªè°ƒç”¨è¿‡ç¨‹ç»“æŸ. é€šè¿‡ä¸€å¼ æµç¨‹å›¾æ¥æè¿°:12345678910111213141516171819202122232425262728â†“: è¡¨ç¤ºè°ƒç”¨ å¼€å§‹ â†“ ReactMount.render â†“ReactMount._renderSubtreeIntoContainer â†“ReactMount._renderNewRootComponent // è§¦å‘åˆ›å»ºçœŸå®DOMèŠ‚ç‚¹ â†“instantiateReactComponent // åˆ›å»ºçœŸå®DOM â†“batchedMountComponentIntoNode â†“mountComponentIntoNode â†“ ReactReconciler.mountComponent â†“ReactCompositeComponent.mountComponent â†“ReactCompositeComponent.performInitialMount â†“ReactMount._mountImageIntoNode â†“ \\ setInnerHTML |---- é€šè¿‡æ ¹èŠ‚ç‚¹æŒ‚è½½ â†“ /ReactDOMComponentTree.precacheNode // ä¿å­˜virtualDOM â†“ ç»“æŸ é€šè¿‡ä¸€å¼ å…³ç³»å›¾æ¥æè¿° å°ç»“&amp;é¢„å‘Š:é€šè¿‡äº†è§£æ¡†æ¶ä¸­å°è£…çš„æ–¹æ³•å†…éƒ¨çš„è°ƒç”¨å®ç°, å¯ä»¥æ›´ç›´è§‚çš„å»äº†è§£æ¡†æ¶, èƒ½å¤Ÿåœ¨åç»­çš„å·¥ä½œå½“ä¸­è®©è‡ªå·±å†™å‡ºæ¥æ€§èƒ½æ›´åŠ é«˜çš„ä»£ç , å¹¶ä¸”å¯¹æ•´ä½“åº”ç”¨èƒ½æœ‰æ‰€è§„åˆ’. \b ä¸‹æœŸé¢„å‘Š: Reactç”Ÿå‘½å‘¨æœŸçš„å…·ä½“åˆ†æ.","link":"/2018/07/22/Reactæºç é˜…è¯»ç³»åˆ—-Â§1.5-ReactDOM-renderå¹²äº†å•¥/"},{"title":"Reactæºç é˜…è¯»ç³»åˆ—-Â§2.2-ä»è™šæ‹ŸDOMåˆ°çœŸå®DOM","text":"å…³é”®å­—: è™šæ‹ŸDOM çœŸå®DOM ä»è™šæ‹ŸDOMèŠ‚ç‚¹é“¾æ¥åˆ°çœŸå®çš„DOMèŠ‚ç‚¹å½“ç»è¿‡æŒ‚è½½/æ›´æ–°, Reactè‡ªå·±ç®¡ç†çš„é‚£ä»½DOMèŠ‚ç‚¹éƒ½ä¼šè¢«æ›´æ–°, æ— è®ºæ˜¯ä»æ— åˆ°æœ‰äº¦æˆ–æ˜¯ä»æ—§åˆ°æ–°, éƒ½éœ€è¦ç»å†çš„ä»è™šæ‹Ÿçš„DOMé“¾æ¥åˆ°çœŸå®çš„DOMå½“ä¸­ç„¶åæ‰èƒ½è¢«æµè§ˆå™¨è¡¨ç°åœ¨é¡µé¢ä¸Š.é‚£ä¹ˆè¿™ä¸€éƒ¨åˆ†åŠŸèƒ½åˆ°åº•æ˜¯æ€ä¹ˆå®Œæˆçš„å‘¢? ä»ä¸Šä¸€èŠ‚ä¸­äº†è§£åˆ°äº†Reactè™šæ‹ŸDOMæ¸²æŸ“å‡ºæ¥çš„DOMç‰‡æ®µåˆ°åº•é•¿ä»€ä¹ˆæ ·, æ¥ä¸‹æ¥å°±è¦çŸ¥é“çš„æ˜¯è¿™ä¸ªä¸œè¥¿åˆ°åº•æ˜¯æ€ä¹ˆè¢«æ¸²æŸ“è¿›å…¥æµè§ˆå™¨çš„DOMå¯¹è±¡å½“ä¸­çš„. ReactMount._mountImageIntoNodeæ­¤å¤„ç”¨æŒ‚è½½æ—¶çš„å‡½æ•°æ–¹æ³•æ¥ä¸¾ä¾‹, æ›´æ–°çš„æŒ‚è½½æ“ä½œç±»ä¼¼, ä½†æˆ‘ä»¬åªå…³æ³¨æ›´æ–°æ“ä½œçš„æ›´æ–°ç­–ç•¥. ReactMount.mountComponentIntoNodeæ–¹æ³•çš„æœ€åé€šè¿‡è°ƒç”¨ReactMount._mountImageIntoNodeæ¥æŠŠæ¸²æŸ“å¥½çš„DOMç‰‡æ®µé“¾æ¥åˆ°DOMå½“ä¸­å»12345678910111213141516171819ReactMount._mountImageIntoNode = function( markup, container, instance, shouldReuseMarkup, transaction, ) { // ... çœç•¥æ‰ä¸€äº›ServerRenderingçš„å¤„ç†ä»£ç ä»¥åŠå¼€å‘é˜¶æ®µæŠ¥é”™çš„ä»£ç  if (transaction.useCreateElement) { while (container.lastChild) { container.removeChild(container.lastChild); } DOMLazyTree.insertTreeBefore(container, markup, null); } else { setInnerHTML(container, markup); ReactDOMComponentTree.precacheNode(instance, container.firstChild); } }}; åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé€šè¿‡DOMLazyTree.insertTreeBeforeæ–¹æ³•, æŠŠæ¸²æŸ“å¥½çš„DOMç‰‡æ®µå¡åˆ°äº†çœŸå®çš„DOMé‡Œ1234567891011121314151617181920// æ­¤å¤„æ–¹æ³•ç»è¿‡ä¸€äº›ç‰¹æ®Šå¤„ç†... æ¥å¤„ç†M$çš„å…¼å®¹æ€§var insertTreeBefore = function( parentNode, tree, referenceNode,) { if ( tree.node.nodeType === DOCUMENT_FRAGMENT_NODE_TYPE || (tree.node.nodeType === ELEMENT_NODE_TYPE &amp;&amp; tree.node.nodeName.toLowerCase() === 'object' &amp;&amp; (tree.node.namespaceURI == null || tree.node.namespaceURI === DOMNamespaces.html)) ) { insertTreeChildren(tree); parentNode.insertBefore(tree.node, referenceNode); } else { parentNode.insertBefore(tree.node, referenceNode); insertTreeChildren(tree); }}; parentNode.insertBeforeæ–¹æ³•å°±æ˜¯DOMæ–¹æ³•Node.insertBefreæ–¹æ³•. åˆ°è¿™è¾¹ç»“æŸä¹‹åæ¸²æŸ“å¥½çš„DOMç‰‡æ®µå°±è¢«æ­£å¼æŒ‚è½½è¿›å…¥äº†DOMå½“ä¸­. ä¸‹èŠ‚é¢„å‘Š: Reactä¸­çš„äº‹åŠ¡å¤„ç†.","link":"/2018/08/04/Reactæºç é˜…è¯»ç³»åˆ—-Â§2.2-ä»è™šæ‹ŸDOMåˆ°çœŸå®DOM/"},{"title":"Reactæºç é˜…è¯»ç³»åˆ—-Â§2.3-äº‹åŠ¡æœºåˆ¶","text":"å…³é”®å­—: transaction batch operation äº‹åŠ¡(Transaction)çš„åŸç†åœ¨å‰é¢æœ‰å‡ èŠ‚ä¸­åå¤æåˆ°äº†Reactçš„äº‹åŠ¡æœºåˆ¶(Transaction), ä»Šå¤©å°±å‡†å¤‡æ¥è®²ä¸€è®²è¿™ä¸ªäº‹åŠ¡æœºåˆ¶åˆ°åº•æ˜¯æ€ä¹ˆä¸ªä¸€å›äº‹.ç”¨ä¸€å¥ç®€å•ä¸€ç‚¹çš„è¯æ¥å½¢å®¹è¿™ä¸ªä¸œè¥¿å°±æ˜¯: åœ¨è°ƒç”¨æŸä¸€ä¸ªå…·ä½“çš„æ–¹æ³•ä¹‹å‰ä¸ä¹‹å, å…ˆè°ƒç”¨ä¸€ç³»åˆ—çš„å¤„ç†å‡½æ•°, ç±»ä¼¼äºnpm installå¯¹åº”çš„npm preinstallå’Œnpm postinstall, åˆ†åˆ«æ‰§è¡Œäºnpm installè¿™ä¸ªè„šæœ¬çš„å¼€å§‹ä¹‹å‰ä¸å®Œæˆä¹‹å. ç”¨ä¸€å¹…å›¾æ¥è¯´æ˜:123456789101112131415161718192021222324/** * wrappers (injected at creation time) * + + * | | * +-----------------|--------|--------------+ * | v | | * | +---------------+ | | * | +--| wrapper1 |---|----+ | * | | +---------------+ v | | * | | +-------------+ | | * | | +----| wrapper2 |--------+ | * | | | +-------------+ | | | * | | | | | | * | v v v v | wrapper * | +---+ +---+ +---------+ +---+ +---+ | invariants * perform(anyMethod) | | | | | | | | | | | | maintained * +-----------------&gt;|-|---|-|---|--&gt;|anyMethod|---|---|-|---|-|--------&gt; * | | | | | | | | | | | | * | | | | | | | | | | | | * | | | | | | | | | | | | * | +---+ +---+ +---------+ +---+ +---+ | * | initialize close | * +-----------------------------------------+ */ è¯¥å›¾ç‰ˆæƒå±äºReactå¼€å‘å›¢é˜Ÿæ‰€æœ‰. åœ¨æŸäº›æ¡†æ¶çš„æºç ä¸­å…¶å®ä¹Ÿä¾ç¨€å¯è§è¿™ç§å¤„ç†çš„æ€æƒ³, ç±»ä¼¼ä½†ä¸ä»…é™äºå¯¹Arrayçš„Nativeæ–¹æ³•çš„åŠ«æŒè°ƒç”¨, å¦‚Vueæ—©æœŸç‰ˆæœ¬å½“ä¸­å¯¹Arrayçš„å¤„ç†ç”¨æ¥æ·»åŠ å‡½æ•°å¤„ç†. äº‹åŠ¡ç±»çš„æ¥å£å®šä¹‰:1234567891011type TransactionImpl = { reinireinitializeTransaction: () =&gt; void; // é‡ç½®wrapper _isIntransaction: boolean; // transactionè°ƒåº¦æ—¶æ ‡è¯†ç¬¦ getTransactionWrappers: () =&gt; Array&lt;TransactionWrapper&gt;; // æ‹¿åˆ°æ‰€æœ‰wrapper isInTransaction: () =&gt; boolean; // å¾—åˆ°_isIntransactionå±æ€§ perform: &lt;A, B, C, D, E, F, G, T: (a: A, b: B, c: C, d: D, e: E, f: F) =&gt; G&gt; (method: T, scope: any, a: A, b: B, c: C, d: D, e: E, f: F) =&gt; G; // äº‹åŠ¡è°ƒåº¦ // åœ¨performæ–¹æ³•ä¸­å…ˆåè°ƒç”¨ this.initializeAll(index) å’Œ this.closeAll(index) initializeAll: (startIndex: number) =&gt; void; // æ‰§è¡Œæ‰€æœ‰wrapperä¸­çš„initializeæ–¹æ³• closeAll: (startIndex: number) =&gt; void; // æ‰§è¡Œæ‰€æœ‰wrapperä¸­çš„closeæ–¹æ³•} åœ¨Reactæ•´ä¸ªç³»ç»Ÿä¸­ä¸€å…±å®ç°äº†3ç§äº‹åŠ¡æ“ä½œç±»(æœåŠ¡ç«¯æ¸²æŸ“å’ŒReactNativeä¸ç®—). ReactUpdatesFlushTransaction ReactBatchingStrategyTransaction ReactReconcileTransaction æ¯ä¸€ç§äº‹åŠ¡ç±»éƒ½è´Ÿè´£å¤„ç†å¯¹åº”çš„æ“ä½œ(ä¸‹é¢ä¼šè¯´åˆ°). ReactUpdates.batchedUpdates()æ–¹æ³•è¢«ç”¨æ¥å¯åŠ¨æ•´ä¸ªæ›´æ–°çš„æ“ä½œ, ç„¶åæŠŠè¿™ä¸ªæ“ä½œçš„åˆ†é…å·¥ä½œäº¤ç»™ReactBatchingUpdateStrategyTransaction ReactBatchingUpdateStrategyTransactionçš„Wrapperå®ç°ä»¥åŠåŠŸèƒ½:1234567891011121314151617181920212223242526272829303132import TransactionImpl from 'Transaction';// å®šä¹‰Wrapper1å·var RESET_BATCHED_UPDATES = { initialize: emptyFunction, // ç©ºæ–¹æ³• close: function() { // æ ‡å¿—ä½ç½®å›false ReactDefaultBatchingStrategy.isBatchingUpdates = false; },};// å®šä¹‰Wrapper2å·var FLUSH_BATCHED_UPDATES = { initialize: emptyFunction, // ç©ºæ–¹æ³• // æ›´æ–°DOM close: ReactUpdates.flushBatchedUpdates.bind(ReactUpdates),};var TRANSACTION_WRAPPERS: Array&lt;TransactionWrapper&gt; = [FLUSH_BATCHED_UPDATES, RESET_BATCHED_UPDATES];}// å½“åœ¨è°ƒç”¨è¿™ä¸ªtransaction.performæ–¹æ³•çš„æ—¶å€™å®é™…ä¸Šæ˜¯è¿™æ ·çš„:/** * * * +----------------------+ +---------------------+ +----------+ * perform -&gt; |FLUSH_BATCHED_UPDATES.| -&gt; |REST_BATCHED_UPDATES.| -----&gt; | method | * | initialize | | initialize | | | * +----------------------+ +---------------------+ +----------+ * | * +----------------------+ +----------------------+ | * |REST_BATCHED_UPDATES. | |FLUSH_BATCHED_UPDATES.| | * | close | | close | &lt;----------+ * +----------------------+ +----------------------+ */ ReactUpdates.flushBatchedUpdatesè°ƒç”¨ReactUpdatesFlushTransaction.perform(runBatchedUpdates)æ–¹æ³•ğŸ‘‡. ReactUpdatesFlushTransactionçš„å®ç°ä»¥åŠåŠŸèƒ½12345678910111213141516171819202122232425262728// Wrapper1å·å®šä¹‰var NESTED_UPDATES = { initialize: function() { this.dirtyComponentsLength = dirtyComponents.length; }, close: function() { if (this.dirtyComponentsLength !== dirtyComponents.length) { // å¤„ç†å½“ Açš„updateè¿‡ç¨‹ä¸­è°ƒç”¨äº†Bçš„setStateæ–¹æ³•çš„æƒ…å†µ dirtyComponents.splice(0, this.dirtyComponentsLength); flushBatchedUpdates(); } else { dirtyComponents.length = 0; } },};// Wrapper2å·å®šä¹‰var UPDATE_QUEUEING = { initialize: function() { this.callbackQueue.reset(); }, close: function() { this.callbackQueue.notifyAll(); },};ReactUpdatesFlushTransaction.prototype.perform = function (method, scope, a) { // è°ƒç”¨ReactReconcileTransactionå»è°ƒç”¨runBatchedUpdatesæ–¹æ³• return Transaction.perform.call(this, this.reconcileTransaction.perform, this.reconcileTransaction, method, scope, a);} ç„¶åå°±åˆ°äº†æˆ‘ä»¬æ‰§è¡Œæ›´æ–°æ“ä½œçš„é‚£ä½é€‰æ‰‹ReactReconcileTransaction ReactReconcileTransactionçš„å®ç°ä»¥åŠåŠŸèƒ½12345678910111213141516171819202122232425262728var SELECTION_RESTORATION = { initialize: ReactInputSelection.getSelectionInformation, close: ReactInputSelection.restoreSelection,};var EVENT_SUPPRESSION = { initialize: function() { var currentlyEnabled = ReactBrowserEventEmitter.isEnabled(); ReactBrowserEventEmitter.setEnabled(false); return currentlyEnabled; }, close: function(previouslyEnabled) { ReactBrowserEventEmitter.setEnabled(previouslyEnabled); },};var ON_DOM_READY_QUEUEING = { initialize: function() { this.reactMountReady.reset(); }, close: function() { this.reactMountReady.notifyAll(); },};var TRANSACTION_WRAPPERS = [ SELECTION_RESTORATION, EVENT_SUPPRESSION, ON_DOM_READY_QUEUEING,]; è‡³æ­¤æ•´ä¸ªäº‹åŠ¡è°ƒç”¨ç»“æŸ ç”±batchingTransaction -&gt; FlushTransaction -&gt; ReconcileTransactionå»è°ƒç”¨äº†ReactUpdates.runBatchedUpdatesæ–¹æ³•, ç„¶ååˆ†åˆ«å¤„ç†äº†callback, DOMäº‹ä»¶ç­‰ä¸€ç³»åˆ—äº‹åŠ¡è°ƒç”¨. ä¸‹èŠ‚é¢„å‘Š: Reactä¸­çš„äº‹ä»¶æœºåˆ¶.","link":"/2018/08/06/Reactæºç é˜…è¯»ç³»åˆ—-Â§2.3-äº‹åŠ¡æœºåˆ¶/"},{"title":"Rust å‡½æ•°","text":"å…³é”®å­—: Rust å‡½æ•° å‡½æ•°æ˜¯ç¼–ç¨‹è¯­è¨€ä¸­å¯¹äºæŸäº›ç°è±¡æˆ–è¿‡ç¨‹çš„æŠ½è±¡, å‡½æ•°åœ¨ Rust ä¸­æ‰®æ¼”ç€é‡è¦çš„ä½œç”¨, ä¸ Javascript ç›¸åŒ, å‡½æ•°åœ¨ Rust ä¸­ä¹Ÿæ˜¯ä½œä¸ºä¸€ç­‰å…¬æ°‘çš„å­˜åœ¨, è¿™ä¹Ÿæ­£æ„å‘³ç€, Rust ä¸­çš„å‡½æ•°å¯ä»¥è¢«ä½œä¸ºä¸€ä¸ªæ•°æ®ç±»å‹åœ¨ç¨‹åºä¸­ç©¿æ’ä¼ é€’. å®šä¹‰ä¸€ä¸ªå‡½æ•°åœ¨ Rust ä¸­, æ— è®ºæ˜¯åœ¨ç‰¹æ€§ä¸­, è¿˜æ˜¯ impl å—ä¸­, æˆ–æ˜¯åœ¨å…¶ä»–åœ°æ–¹å£°æ˜ä¸€ä¸ªå‡½æ•°, éƒ½æ˜¯ä½¿ç”¨ä¸€æ ·çš„å†™æ³•, å’Œ Javascript ä¸åŒ(æ—¢æœ‰å‡½æ•°å£°æ˜, ä¹Ÿæœ‰å‡½æ•°è¡¨è¾¾å¼).Rust ä¸­çš„å‡½æ•°å£°æ˜: fn name(arg: type) -&gt; returnType { body block } æ™®é€šå‡½æ•°123fn add(a: isize, b: isize) -&gt; isize { a + b} å‡½æ•°åšä¸ºå‚æ•°12345fn &lt;T&gt;inner_add(a: T, b: T, add: fn(a: T, b: T) -&gt; T) -&gt; T { add(a, b)}inner_add(1, 2, |a, b| a + b); å‡½æ•°è¿”å›å£°æ˜ä¸€ä¸ªå‡½æ•°, å¹¶ä¸”è¿”å›ä¸€ä¸ªè¿”å›å€¼, åœ¨å¤§å¤šæ•°è¯­è¨€ä¸­éƒ½éœ€è¦ç”¨åˆ°, return è¿™ä¸ªå…³é”®å­—, ä½†åœ¨ Rust ä¸­, è¿™ä¸ªå…³é”®å­—å¯ä»¥çœç•¥æ‰, ç”¨æ›´ç®€å•çš„æ–¹å¼è¿”å›. å¦‚ä¾‹å­: 123fn add(a: i32, b: i32) -&gt; i32 { a + b // æ³¨æ„è¿™é‡Œæ²¡æœ‰è·Ÿåˆ†åˆ†å·} æˆ–è€…æ˜¾å¼åœ°è¿”å›è¿™ä¸ªè¯­å¥ 123fn add(a: i32, b: i32) -&gt; i32 { return a + b; // æ³¨æ„è¿™é‡Œè·Ÿåˆ†å·} ä½†æ˜¯å¦‚æœåœ¨å‡½æ•°å—ä¸­, æœ€åä¸€æ¡è¯­å¥ä»¥ ; ç»“å°¾, å¹¶æ²¡æœ‰ return å…³é”®å­—, é‚£ä¹ˆç¼–è¯‘å™¨ä¾¿ä¼šè‡ªåŠ¨åœ¨ä»£ç ä¸­æ’å…¥ () è¿™ä¸ªç‰¹æ®Šçš„å…ƒç»„ä½œä¸ºè¿”å›å€¼, æ‰€ä»¥å¦‚æœä¸€ä¸ªå‡½æ•°æ²¡æœ‰å£°æ˜è¿”å›å€¼, éƒ½ä¼šä»¥ä¸€ä¸ª () ä½œä¸ºè¿”å›, å½“ç„¶, è¿™ä¹Ÿæ˜¯å¯é€‰æ‹©çš„, è‹¥ä¸æƒ³è¦å‡½æ•°è¿”å›ä»»ä½•å€¼, å¯ä»¥å°†è¿”å›å€¼è®¾ç½®æˆ !, ä»£è¡¨è¿™ä¸ªå‡½æ•°ä¸è¿”å›ä»»ä½•å€¼. return å…³é”®å­—å®é™…ä¹Ÿæ˜¯å¾ˆæœ‰ç”¨çš„, æ¯”å¦‚åœ¨ä¸€æ®µæ¡ä»¶è¯­å¥ä¸­, æå‰è¿”å›ç»“æœ 12345678fn ahead_return() -&gt; String { for i in 0..10 { if i == 5 { return \"ahead returned\".to_string(); // æå‰è¿”å› } } \"normal returned\".to_string() //ç›´æ¥è¿”å›} è¿”å›å¤šä¸ªå€¼çš„å‡½æ•°åœ¨ Rust ä¸­, ä¸€ä¸ªå‡½æ•°çš„è¿”å›, \b å¯ä»¥æ²¡æœ‰å€¼, å¯ä»¥æœ‰ä¸€ä¸ªå€¼, ä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªå€¼, åœ¨ Rust ä¸­, å‡½æ•°è¦è¿”å›å¤šä¸ªå€¼, å¯ä»¥ç›´æ¥é‡‡ç”¨è¿”å›ä¸€ä¸ªå…ƒç»„, å¦‚æœå‡½æ•°æ²¡æœ‰è¿”å›å€¼. 123fn tuple_return() -&gt; (i32, i32) { (1, 2)} è¿”å›å‡½æ•°çš„å‡½æ•°åŒæ ·, Rust ä¸æ­¢å¯ä»¥ä¼ å…¥å‡½æ•°ä½œä¸ºå‚æ•°, è¿˜èƒ½å¤Ÿè¿”å›ä¸€ä¸ªå‡½æ•°ä½œä¸ºè¿”å›å€¼. 12345678910type is_one = fn(arg: i32) -&gt; bool;fn returned(arg: i32) -&gt; bool { arg == 1i32}fn caller() -&gt; is_one { returned}println!(\"{:?}\", caller()(1)); // æ˜¯ä¸æ˜¯æœ‰ä¸€è‚¡å¾ˆç†Ÿæ‚‰çš„æ„Ÿè§‰ \b ä½œç”¨åŸŸä¸ç”Ÿå‘½å‘¨æœŸåœ¨ä»‹ç»é—­åŒ…ä¹‹å‰, éœ€è¦å…ˆä»‹ç»ä¸€ä¸‹ Rust ä¸­çš„ä½œç”¨åŸŸç›¸å…³çš„çŸ¥è¯†. Rust ä¸­æ‰€æœ‰çš„ä½œç”¨åŸŸéƒ½æ˜¯é™æ€ä½œç”¨åŸŸ (Lexical Scope), é€šè¿‡æˆå¯¹çš„èŠ±æ‹¬å·æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸ 123456789101112fn add(a: i32, b: i32) { // ä½œç”¨åŸŸ 1 { // ä½œç”¨åŸŸ 2 { // ä½œç”¨åŸŸ 3 let s = \"some string\"; } // ä½œç”¨åŸŸ 3 é€€å‡º, s è¢«é‡Šæ”¾ println!(\"{:?}\", s); // error[E0425]: cannot find value `s` in this scope }} é—­åŒ… (Closure)åœ¨ Rust ä¸­çš„é—­åŒ…åˆå«åšä¸€ä¸ªåŒ¿åå‡½æ•°, ä½†é—­åŒ…å’Œæ™®é€šçš„å‡½æ•°æœ‰å‡ ç‚¹ä¸åŒ èƒ½å¤Ÿæ•æ‰è°ƒå½“å‰ä½œç”¨åŸŸé‡Œçš„å˜é‡ ç¼–è¯‘å™¨èƒ½å¤Ÿè‡ªåŠ¨æ¨æ–­è¾“å…¥å’Œè¿”å› åœ¨ Rust ä¸­æœ€å¸¸ç”¨åˆ°é—­åŒ…çš„åœ°æ–¹å°±æ˜¯äº§ç”Ÿå­çº¿ç¨‹, å’Œè¿­ä»£å™¨çš„ä¸€äº›æ“ä½œ:å¦‚: äº§ç”Ÿä¸€ä¸ªå­çº¿ç¨‹, ç„¶åè®¡ç®—è¿”å›12345678910111213use std::thread;fn main() { let a = String::from(\"Parent string\"); let child = thread::spawn(move || { println!(\"String from parent thread {:?}\", a); // some work here return String::from(\"child thread string\"); }); // some work here let res = child.join(); println!(\"{:?}\", a); // error[E0382]: borrow of moved value: `a` println!(\"{:?}\", res.unwrap());} è¿™ä¸ªä¾‹å­è¿˜å±•ç¤ºäº†é—­åŒ…çš„ move å…³é”®å­—, è¿™ä¸ªå…³é”®å­—å¯ä»¥æŠŠé—­åŒ…å‡½æ•°ä½“ä¸­ç”¨åˆ°è¿‡çš„å˜é‡çš„æ‰€æœ‰æƒè½¬ç§»åˆ°é—­åŒ…å†…, è¿™æ ·ä¸€æ¥, é—­åŒ…å¤–çš„å˜é‡çš„æ‰€æœ‰æƒå°±è¢«è½¬ç§»äº†, å› æ­¤, è¿™ä¸ªå˜é‡ä¹Ÿä¸å­˜åœ¨äºè¿™ä¸ªä½œç”¨åŸŸä¸­, å®ƒçš„ç”Ÿå‘½å‘¨æœŸå°±å±äºå½“å‰è¿™ä¸ªé—­åŒ…çš„ä½œç”¨åŸŸ, å½“é—­åŒ…é€€å‡ºçš„æ—¶å€™, é‚£ä¹ˆè¿™ä¸ªå˜é‡ä¹Ÿè¢«å›æ”¶äº†.æˆ–è€…å¯¹\bè¿­ä»£å™¨åšæ“ä½œ123let v = vec![1, 2, 3, 4, 5, 6, 7, 8, 9, 10];let mapped: Vec&lt;i32&gt; = v.into_iter().map(|val| val + 1 ).collect();println!(\"{:?}\", mapped); // [2, 3, 4, 5, 6, 7, 8, 9, 10, 11]; \bè¿™äº›éƒ½æ˜¯å¾ˆå…¸å‹çš„é—­åŒ…ç”¨ä¾‹, åŒå‡½æ•°ä¸€æ ·, é—­åŒ…æ—¢å¯ä»¥ä½œä¸ºå‚æ•°, ä¹Ÿå¯ä»¥ä½œä¸ºè¿”å›. \bè¿™äº›ä¹Ÿåªæ˜¯ Rust è¯­è¨€ä¸­å‡½æ•°ä½¿ç”¨çš„å†°å±±ä¸€è§’, å‡½æ•°æœ‰éå¸¸å¼ºå¤§çš„åŠŸèƒ½. To be continued â€¦","link":"/2019/03/16/Rust-å‡½æ•°/"},{"title":"Rust è¿ç®—ç¬¦","text":"å…³é”®å­—: Rust è¿ç®—ç¬¦ ç‰¹æ€§ é‡è½½ åœ¨ Rust é‡Œ, æœ‰å¾ˆå¤šä¸ä¸€æ ·çš„æ“ä½œç¬¦, ç±»ä¼¼ + - * / è¿ç®—ç¬¦, æ¯ä¸ªè¿ç®—ç¬¦åœ¨ä¸åŒçš„åº”ç”¨æ¡ä»¶ä¸‹è¡¨è¾¾çš„æ„æ€ä¹Ÿå¯èƒ½ä¸ä¸€æ ·, è€Œ Rust ä¸­çš„è¿ç®—ç¬¦å¾ˆç‰¹æ®Š, Rust ä¸­çš„è¿ç®—ç¬¦æ”¯æŒé‡è½½, è¿ç®—ç¬¦é‡è½½è¿™ä¸ªç‰¹æ€§åœ¨å¤§éƒ¨åˆ†è¯­è¨€ä¸­éƒ½æ²¡æœ‰å¾—åˆ°æ”¯æŒ, è€Œ Rust æ”¯æŒäº†è¿™ä¸€ç‰¹æ®Šçš„ç‰¹æ€§. Rust ä¸­çš„è¿ç®—ç¬¦ è¿ç®—ç¬¦ ä¸¾ä¾‹ æè¿° é‡è½½æ–¹æ³• ! ident!(â€¦),ident!{â€¦},ident![â€¦] Macro expansion ! !expr Bitwise or logical complement Not != var != expr Nonequality comparison PartialEq % expr % expr Arithmetic remainder Rem %= var %= expr Arithmetic remainder and assignment RemAssign &amp; &amp;expr, &amp;mut expr Borrow &amp; &amp;type, &amp;mut type, &amp;â€™a type, &amp;â€™a mut type Borrowed pointer type &amp; expr &amp; expr Bitwise AND BitAnd &amp;= var &amp;= expr Bitwise AND and assignment BitAndAssign &amp;&amp; expr &amp;&amp; expr Logical AND * expr * expr Arithmetic multiplication Mul *= var *= expr Arithmetic multiplication and assignment MulAssign * *expr Dereference * const type, mut type Raw pointer + trait + trait, â€˜a + trait Compound type constraint + expr + expr Arithmetic addition Add += var += expr Arithmetic addition and assignment AddAssign , expr, expr Argument and element separator - - expr Arithmetic negation Neg - expr - expr Arithmetic subtraction Sub -= var -= expr Arithmetic subtraction and assignment SubAssign -&gt; fn(â€¦) -&gt; type, |â€¦| -&gt; type Function and closure return type . expr.ident Member access .. .., expr.., ..expr, expr..expr Right-exclusive range literal ..= ..=expr, expr..=expr Right-inclusive range literal .. ..expr Struct literal update syntax .. variant(x, ..), struct_type { x, .. } â€œAnd the restâ€ pattern binding â€¦ exprâ€¦expr In a pattern: inclusive range pattern / expr / expr Arithmetic division Div /= var /= expr Arithmetic division and assignment DivAssign : pat: type, ident: type Constraints : ident: expr Struct field initializer : â€˜a: loop {â€¦} Loop label ; expr; Statement and item terminator ; [â€¦; len] Part of fixed-size array syntax &lt;&lt; expr &lt;&lt; expr Left-shift Shl &lt;&lt;= var &lt;&lt;= expr Left-shift and assignment ShlAssign &lt; expr &lt; expr Less than comparison PartialOrd &lt;= expr &lt;= expr Less than or equal to comparison PartialOrd = var = expr, ident = type Assignment/equivalence == expr == expr Equality comparison PartialEq =&gt; pat =&gt; expr Part of match arm syntax &gt; expr &gt; expr Greater than comparison PartialOrd &gt;= expr &gt;= expr Greater than or equal to comparison PartialOrd &gt;&gt; expr &gt;&gt; expr Right-shift Shr &gt;&gt;= var &gt;&gt;= expr Right-shift and assignment ShrAssign @ ident @ pat Pattern binding ^ expr ^ expr Bitwise exclusive OR BitXor ^= var ^= expr Bitwise exclusive OR and assignment BitXorAssign | pat | pat Pattern alternatives | expr | expr Bitwise OR BitOr |= var |= expr Bitwise OR and assignment BitOrAssign || expr || expr Logical OR ? expr? Error propagation è¿™äº›å¯é‡è½½çš„æ“ä½œç¬¦çš„ç‰¹æ€§éƒ½åœ¨ std::ops è¿™ä¸ªåŒ…ä¸­è¢«å¯¼å‡º. ä¸€å…ƒè¿ç®—ç¬¦ (Unary Operator)å½“è¿ç®—ç¬¦ä½œä¸ºä¸€å…ƒè¿ç®—ç¬¦æ—¶, æ²¡æœ‰é‡è½½çš„æ“ä½œ. * &amp; è¿™ä¸€å¯¹è¿ç®—ç¬¦ä½œä¸ºä¸€å…ƒè¿ç®—ç¬¦çš„æ—¶å€™æ˜¯ä¸€å¯¹ä½œç”¨ç›¸åçš„è¿ç®—ç¬¦. &amp; è¿ç®—ç¬¦ç”¨äºå–å¼•ç”¨, ä¹Ÿå°±æ˜¯ Rust ä¸­çš„ Borrow æ¦‚å¿µ, å¯ä»¥å¤§è‡´ç†è§£ä¸º C/C++ ä¸­çš„å–å€æ“ä½œ; * è¿ç®—ç¬¦ç”¨äºè§£å¼•ç”¨. - è¿ç®—ç¬¦ç”¨äºå–è´Ÿæ•°, ç”¨äº integer/float ç±»å‹. ! ä½å–åè¿ç®—ç¬¦, å°†è¿ç®—å¯¹è±¡æŒ‰ä½å–å å¦‚ !b0000_0001 ç»“æœä¸º b1111_1110; äºŒå…ƒè¿ç®—ç¬¦ (Binary Operator)ç®—æ•°è¿ç®—ç¬¦+ - * / % å’Œå…¶å®ƒè¯­è¨€ä¸­çš„ç®—æ•°è¿ç®—ç¬¦ä¸€æ¨¡ä¸€æ ·, ç”¨äºç®—æœ¯è¿ç®— ä½è¿ç®—&amp; | ^ &lt;&lt; &gt;&gt; ä½è¿ç®—ç¬¦ä¹Ÿå‡ ä¹å’Œ C/C++ è¯­è¨€ä¸­çš„ä½è¿ç®—ç¬¦ä¸€æ ·. æ¯”è¾ƒè¿ç®—ç¬¦&gt; &gt;= == != &lt;= &lt; è¿™äº›è¿ç®—ç¬¦ç”¨äºå€¼çš„æ¯”è¾ƒ, è¦æ³¨æ„çš„åœ°æ–¹æ˜¯æ¯”è¾ƒè¿ç®—ä¹Ÿå¿…é¡»è¦å‘ç”Ÿåœ¨åŒä¸€ç§ç±»å‹çš„å€¼ä¹‹é—´, å¦‚ 8i32 &lt; 9i64 è¿™æ ·çš„æ¯”è¾ƒæ˜¯ä¼šè¢«ç¼–è¯‘å™¨æŠ›é”™çš„. æ¯”è¾ƒè¿ç®—ç¬¦ä¼šäº§ç”Ÿä¸€ä¸ª bool ç±»å‹çš„å€¼ æ–­è¨€è¿ç®—ç¬¦&amp;&amp; || ä½œä¸ºé€»è¾‘çŸ­è·¯æ–­è¨€è¿ç®—ç¬¦, å’Œå…¶å®ƒè¯­è¨€ä¸­çš„ä½œç”¨æ˜¯ä¸€æ ·çš„, ä½†æ˜¯ expr &amp;&amp; expr ä¸­çš„ expr å¿…é¡»æ˜¯ bool ç±»å‹, è¿™ç‚¹æ˜¯å’Œå…¶å®ƒè¯­è¨€ä¸ä¸€æ ·çš„åœ°æ–¹. è¿ç®—ç¬¦é‡è½½è¿ç®—ç¬¦é‡è½½å®é™…ä¸Šé€šå¸¸åªæ˜¯ä¸€ç§ è¯­æ³•ç³–. å®ƒå¯ä»¥ç®€å•åœ°é€šè¿‡å‡½æ•°è°ƒç”¨æ¥æ¨¡æ‹Ÿå¦‚1a + b * c // a b c å‡ä¸æ˜¯æ•°å€¼ç±»å‹ ä½†å´æ”¯æŒç”¨è¿ç®—ç¬¦ æ¨¡æ‹Ÿ1add(a, multiply(b, c)) // å‡è®¾ä¹˜æ³•ä¼˜å…ˆçº§æ˜¯é«˜äºåŠ æ³•çš„ å‡è®¾æˆ‘ä»¬éœ€è¦å»å®ç°åŠ æ³•çš„é‡è½½, æˆ‘ä»¬å°±å¿…é¡»è¦ç”¨åˆ° Add è¿™ä¸ªç‰¹æ€§, Add è¿™ä¸ª ç‰¹æ€§çš„ç­¾åæ˜¯:1234567// è¿™é‡Œçš„ RHS æ³›å‹ é»˜è®¤å€¼æ˜¯ Self ä¹Ÿå°±æ˜¯å½“å‰å®ç°è¿™ä¸ªç‰¹æ€§çš„ç±»å‹// åŒæ ·, ä½ ä¹Ÿå¯ä»¥æŒ‡å®šè¿™ä¸ªåœ°æ–¹çš„ RHS ä¸ºåˆ«çš„ç±»å‹pub trait Add&lt;RHS = Self&gt; { type Output; // è¿™ä¸ªç±»å‹æ˜¯ç”¨æ¥å®šä¹‰è¿”å›å€¼çš„ [must_use] fn add(self, rhs: RHS) -&gt; Self::Output; // å®ç° Add ç‰¹æ€§å¿…é¡»è¦å®ç° add è¿™ä¸ªæ–¹æ³•} \båœ¨ Rust ä¸­çš„é‡è½½å®é™…å¾ˆç®€å•, å¦‚æˆ‘ä»¬è¦å®ç°åŠ æ³•è¿ç®—çš„é‡è½½å°±å¯ä»¥è¿™æ ·:123456789101112131415161718use std::ops::Add; // è½½å…¥ Add ç‰¹æ€§#[derive(Debug, Clone, Copy)]struct Foo { a: u32, b: u32,}impl Add for Foo { type Output = Foo; fn add(self, rhs: Foo) -&gt; Foo { // rhs = right hand side println!(\"Add è¿ç®—ç¬¦é‡è½½!\"); return Foo { a: self.a + rhs.a, b: self.b + rhs.b } }} è¿™äº›å°±æ˜¯ Rust ä¸­çš„è¿ç®—ç¬¦, è¿ç®—ç¬¦æœ‰éå¸¸å¤š, éœ€è¦èŠ±æ—¶é—´å»è®°å¿†, æœ‰å¾ˆå¤šä¸å¸¸ç”¨ä½†éå¸¸å¥½ç”¨çš„è¿ç®—ç¬¦, éœ€è¦é åœ¨å®è·µä¸­å¤šä½¿ç”¨, æ…¢æ…¢ä¼šç†Ÿæ‚‰èµ·æ¥. To be continued â€¦","link":"/2019/03/13/Rust-è¿ç®—ç¬¦/"},{"title":"Rust æ§åˆ¶æµ","text":"å…³é”®å­—: Rust æ§åˆ¶æµ ä»£ç è·‘ä¸ä¸è·‘, è·‘äº†ä¹‹åçš„ç»“æœæ˜¯ä»€ä¹ˆ, éƒ½ä¾èµ–äºæ§åˆ¶æµ, Rust ä¸­çš„æ§åˆ¶æµåˆ†ä¸ºä¸¤å¤§ç±» åˆ¤æ–­ å¾ªç¯ åˆ¤æ–­è¡¨è¾¾å¼ifåœ¨ Rust ä¸­, if ä»å¥ä¸æ˜¯ä¸€ä¸ªå£°æ˜è¯­å¥, æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼, ä¸ Java/Javascript ä¸­çš„ if ä¸åŒ:Rust ä¸­:123456let number = 10;let a = if number &lt; 10 { 20} else { 1} Javascript ä¸­:1234567let number = 10;let a;if (number &lt; 10) { a = 20;} else { a = 1;} if letif ä»å¥è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„åˆ†æ”¯ å°±æ˜¯ if let, å®é™…ä¸Šè¿™ä¸ªå†™æ³•æ˜¯å¯¹æ¥ä¸‹æ¥è¦è®²çš„ match çš„ä¸€ä¸ªç®€å†™1234567let a = Some(\"b\");// è¿™é‡Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªåŒ¹é…çš„è§£æ„, åœ¨ä¸‹é¢ä¼šè¯´åˆ°let c = if let Some(val) = a { \"equal\" // ä¸èƒ½æœ‰åˆ†å·, å› ä¸ºæ˜¯è¿”å›å€¼} else { \"not equal\"} 1. Rust ä¸­çš„ if æ˜¯è¡¨è¾¾å¼è€Œä¸æ˜¯å£°æ˜è¯­å¥2. Rust ä¸­çš„ if åæ¥ç»­çš„æ¡ä»¶åªèƒ½æ˜¯ bool ç±»å‹, è€Œä¸èƒ½åƒ Javascript ä¸€æ ·ä»»æ„ç±»å‹çš„å€¼éƒ½å¯ä»¥. matchmatch è¡¨è¾¾å¼åœ¨ Rust ä¸­å°±åƒ Javascript ä¸­çš„ switch å£°æ˜ä¸€æ ·, ä½†åŠŸèƒ½è¿œæ¯” switch çš„åŠŸèƒ½å¼ºå¤§123456789101112131415161718enum Coin { Penny, Nickel, Dime, Quarter,}let coin = Coin::Quater;let money = match coin { Coin::Penny =&gt; { println!(\"Lucky penny!\"); 1 }, Coin::Nickel =&gt; 5, Coin::Dime =&gt; 10, Coin::Quarter =&gt; 25,} å…¶ä¸­æœ€å¸¸ç”¨çš„ç”¨æ³•å°±æ˜¯é…åˆ Enum ç±»å‹, å¸¦æœ‰æ•°æ®çš„æšä¸¾ç±»é€šè¿‡åŒ¹é…èƒ½å¤Ÿæ‹¿åˆ°æºå¸¦çš„æ•°æ®, æ¥æä¾›ä½¿ç”¨. å¾ªç¯ä½“Rust ä¸€å…±æä¾›äº†ä¸‰ç§å¾ªç¯çš„æ–¹å¼: loop while for loopåœ¨ Rust ä¸­, æœ€å¸¸è§çš„å¾ªç¯æ–¹å¼å°±æ˜¯ loop è¯­å¥, é€šè¿‡ loop è¯­å¥äº§ç”Ÿå¾ªç¯, ç„¶ååœ¨å¾ªç¯ä½“ä¸­é€šè¿‡ break, continue, return, è¿™äº›å…³é”®å­—æ¥æ§åˆ¶å¾ªç¯æµ, æœ€åè¾¾åˆ°ç›®çš„. ä¸å‡ºæ„å¤–åœ°, loop ä¾ç„¶è¿˜æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼, å¹¶ä¸”æ˜¯èƒ½å¤Ÿè¿”å›å€¼çš„ _(:Ğ·ã‚âˆ )_. æœ€ç®€å•çš„å¾ªç¯ 123loop { println!(\"æ— é™å¾ªç¯\");} ä¸­æ–­çš„å¾ªç¯ 12345678let mut sum = 0;let final_sum = loop { if sum &gt; 10 { break sum // break è¿™æ®µå¾ªç¯ å¹¶è¿”å› sum } sum += 1;};println!(\"{:?}\", final_sum); whileå’Œ loop ç›¸æ¯”, å¦å¤–ä¸€ä¸ªç”¨å¾—æ¯”è¾ƒå¤šçš„å¾ªç¯è¯­å¥å°±æ˜¯ while, while æ¯”è¾ƒèµ· loop æ¥, æ˜æ˜¾çš„åŒºåˆ«å°±æ˜¯, while å¾ªç¯çš„æ¡ä»¶è¯­å¥å¤–ç½®å¹¶ä¸” while è¯­å¥æ²¡æœ‰è¿”å›å€¼(æˆ–è€…è¯´è¿”å›å€¼æ˜¯ä¸€ä¸ªç©ºå…ƒç»„()), å½“å¾ªç¯æ¡ä»¶ä¸æ»¡è¶³, å¾ªç¯å°±ç›´æ¥ç»“æŸ. å’Œ loop ä¸€æ ·æ•ˆæœçš„å¾ªç¯1234while true { println!(\"æˆ‘å’Œ loop ä¸€æ ·è€¶\"); // å¯ä»¥åœ¨å¾ªç¯ä½“ä¸­æ’å…¥ break return è¯­å¥ä½œä¸ºä¸­æ–­} \bæ¡ä»¶å¾ªç¯1234let mut counter = 0;while counter &lt; 10 { counter += 1;} forfor å¾ªç¯ç›¸å¯¹æ¥è¯´æ¯”è¾ƒç‰¹æ®Š, åªèƒ½ç”¨åœ¨é‚£äº›å®ç°è¿‡ iterator ç‰¹æ€§çš„å¯¹è±¡ä¸Š, \bæ²¡æœ‰å®ç°è¿™ä¸ªç‰¹æ€§çš„å¯¹è±¡æ˜¯æ²¡æœ‰åŠæ³•ç”¨ for è¯­å¥è¡¨è¾¾çš„, for è¯­å¥æ˜¯å£°æ˜, è€Œä¸æ˜¯è¡¨è¾¾å¼, æ‰€ä»¥ä¹Ÿæ˜¯æ²¡åŠæ³•ä½¿ç”¨break value çš„.123for item in 1..11 { // from..to äº§å‡ºä¸€ä¸ªåŒºé—´ä¸º [from, to) Range ç±»å‹çš„å¯¹è±¡, å®ç°äº† iterator println!(\"{:?}\", item);} ä»¥ä¸Šå°±æ˜¯ Rust ä¸­çš„æ§åˆ¶æµ, æ¯ä¸€ä¸ªéƒ½æä¾›äº†éå¸¸å¼ºå¤§çš„åŠŸèƒ½, å®é™…åº”ç”¨ä¸­æ ¹æ®ä¸åŒçš„åœºæ™¯åº”ç”¨, æ¥è¾¾åˆ°ä¸åŒçš„ç›®çš„.","link":"/2019/03/12/Rustçš„æ§åˆ¶æµ/"},{"title":"react 16 é€†å‘ç³»åˆ—","text":"å…³é”®å­—: React Fiber Hooks react 16.x é€†å‘å·¥ç¨‹ä¸Šä¸€éƒ¨é€†å‘çš„å‘è¿˜æ²¡å¡«å®Œ, åˆå¼€ä¸‹ä¸€ä¸ªå‘, -&gt;_-&gt; è¿™æ¬¡æ¥é€†å‘ä¸€ä¸‹ 16.x ç‰ˆæœ¬çš„ React,åœ¨è¿™ä¸ªç›®å½•æ–‡å†™å‡ºæ¥çš„æ—¶å€™, React åœ¨çº¿ä¸Šçš„æ­£å¼ç‰ˆæœ¬æ˜¯ 16.8.10, å¸Œæœ›åˆ°è¿™ä¸ªç³»åˆ—å†™å®Œä¹‹å‰, React éƒ½ä¸ä¼šå‘å¸ƒ 17.0 beta ç‰ˆæœ¬. å®é™…ä¸Š React 16.x ç‰ˆæœ¬çš„æºç ç›¸è¾ƒäº 15.x æ—¶æœŸ, ä¸è®ºä»£ç ç»„ç»‡, è¿˜æ˜¯ä»£ç è´¨é‡ä¸Šåˆæ›´ä¸Šäº†ä¸€å±‚æ¥¼, æ›´å¼•è¿›äº†å¾ˆå¤šæ–°çš„ä¸œè¥¿ lazy, memo, contextType Hooks æœ¬ç‰ˆæœ¬é™¤ Fiber ä»¥å¤–æœ€é‡å¤§çš„ feature (ä¸ªäººè§’åº¦) Profiler, Suspense Brand new Context 0b0001 ä»åˆ†ç‰‡è°ƒåº¦æ¥çœ‹ React çš„è°ƒåº¦æœºåˆ¶0b0010 React Fiber è°ƒåº¦å™¨çš„å®ç° (æ–½å·¥ä¸­ğŸš§ â€¦)åç»­ç›®å½•å¾…è¡¥å…¨","link":"/2019/03/28/react-16/"},{"title":"Reactæºç é˜…è¯»ç³»åˆ—-Â§2.1-ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹è¯¦è§£","text":"å…³é”®å­—: ç”Ÿå‘½å‘¨æœŸ é’©å­å‡½æ•° åœ¨Â§1.1èŠ‚å¤§æ¦‚çš„äº†è§£äº†Reactçš„ç”Ÿå‘½å‘¨æœŸä»¥åŠåœ¨å„ä¸ªé˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°çš„è°ƒç”¨. åœ¨æœ¬èŠ‚ä¸»è¦è¯¦ç»†è®²è§£å„ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°, ä»¥åŠä¸€äº›å¯¹æ€§èƒ½ä¸Šèƒ½å¤Ÿäº§ç”Ÿä¼˜åŒ–çš„ç»†èŠ‚. ä»¥ä¸‹é¢å†…å®¹ä»…é€‚ç”¨äºç”¨æˆ·è‡ªå®šä¹‰ç»„ä»¶, æ— çŠ¶æ€ç»„ä»¶ä¸ç»å†å¤§éƒ¨åˆ†é’©å­å‡½æ•°çš„è°ƒç”¨. \bç”Ÿå‘½å‘¨æœŸçš„é˜¶æ®µæ¯ä¸€ä¸ªReactçš„ç»„ä»¶éƒ½ä¼šç»å†å®ƒçš„ç”Ÿå‘½å‘¨æœŸ. 1. æŒ‚è½½é˜¶æ®µ (Mounting Period) 1) ç»„ä»¶è¢«å®ä¾‹åŒ– åœ¨ä¹‹å‰çš„Â§1.3èŠ‚è®²åˆ°æ¯ä¸€ä¸ªCustomComponentéƒ½æ˜¯è¢«CompositeComponentWrapperç»™åŒ…è£¹äº†èµ·æ¥, å®é™…è¢«å®ä¾‹åŒ–çš„åœ°æ–¹æ˜¯åœ¨ReactCompositeComponent._constructComponentWithoutOwneræ–¹æ³•ä¸­. 1return new CustomComponent(publicProps, publicContext, updateQueue); æ­¤å¤„å°±æ˜¯æ‰€æœ‰çš„ç»„ä»¶çš„æ„é€ å‡½æ•°è¢«è°ƒç”¨çš„åœ°æ–¹. ä¸ºçš„æ˜¯æŠŠå®ä¾‹å­˜åœ¨ReactInstanceMapä¸­, æ–¹ä¾¿ä½¿ç”¨, ä¾‹å¦‚React.findDOMNode()æ–¹æ³•å°±é€šè¿‡è¿™ä¸ªReactInstanceMapæ‹¿åˆ°äº†å®ä¾‹é€šè¿‡å®ä¾‹åœ¨å¯¹åº”çš„ReactDOMTreeä¸­æ‰¾åˆ°äº†å¯¹åº”çš„DOMèŠ‚ç‚¹. 2) componentWillMountçš„è°ƒç”¨ æ— çŠ¶æ€ç»„ä»¶æ˜¯ä¸ç»å†è¿™ä¸€æ­¥çš„, å¦‚æœç”¨æˆ·æœ‰æ·»åŠ componentWillMountè¿™ä¸ªæ–¹æ³•, é‚£ä¹ˆè¯¥æ–¹æ³•å°†ä¼šåœ¨performInitialMountæ–¹æ³•å†…è¢«è°ƒç”¨. 3) renderçš„è°ƒç”¨æ—¶æœº renderè¢«è°ƒç”¨æœ‰ä¸¤ç§æƒ…å†µ. ç¬¬ä¸€ç§æƒ…å†µæ˜¯å¦‚æœç»„ä»¶æœ¬èº«æ˜¯æ— çŠ¶æ€ç»„ä»¶é‚£ä¹ˆåœ¨ 123456789101112var renderedElement;// å¦‚æœæ˜¯æ— çŠ¶æ€çš„ç»„ä»¶è¿”å›false, å¦åˆ™è¿”å›true.var doConstruct = shouldConstruct(Component);var inst = this._constructComponent( doConstruct, // false publicProps, publicContext, updateQueue, );if (!doConstruct &amp;&amp; (inst == null || inst.render == null)) { renderedElement = inst; } æ–¹æ³•å†…éƒ¨è¿™ä¸ªç»„ä»¶çš„renderæ–¹æ³•å°±å¯ä»¥çœ‹åšå·²ç»è¢«è°ƒç”¨è¿‡äº†, å› ä¸ºæœ¬èº«å°±åªæ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹çš„ç»„ä»¶. ç¬¬äºŒç§æ˜¯å¦‚æœå¹¶éæ— çŠ¶æ€ç»„ä»¶, é‚£ä¹ˆrenderçš„è°ƒç”¨å‘ç”Ÿåœ¨performInitialMountæ–¹æ³•ä¸­1234// åœ¨ä¸æ»¡è¶³ä¸Šé¢çš„æ¡ä»¶æ—¶, renderedElementè‡ªç„¶ä¸ºundefined.if (renderedElement === undefined) { renderedElement = this._renderValidatedComponent(); // æ­¤å¤„è°ƒç”¨inst.render()} è¿™é‡Œçš„renderedElementå°±æ˜¯åœ¨ç¬¬Â§1.2èŠ‚é€šè¿‡render()æ–¹æ³•è¿”å›å‡ºæ¥çš„React.createElement()çš„ç»“æ„. æ˜¯ä¸€ä¸ªReactElementçš„ç±»å®ä¾‹. ç„¶åä¼šè¢«ç”¨æ¥é€šè¿‡è¿›è¡Œä¸€ä¸ªé€’å½’è°ƒç”¨, æ‰€æœ‰çš„è‡ªå®šä¹‰ç»„ä»¶éƒ½ä¼šè¢«è½¬æ¢åˆ°ReactDOMComponent, ç„¶åé€šè¿‡ReactDOMComponent.mountComponentæ–¹æ³•è¿”å›ä¸€æ®µReactNodeçš„å¯¹è±¡å®ä¾‹ æœ€åè°ƒç”¨renderæ–¹æ³•ä¹‹åå¾—åˆ°çš„markupç±»ä¼¼äº: ä»ReactCompositeComponentåˆ°ReactDOMComponent, ç„¶åå†è¢«è½¬æ¢æˆä¸ºçœŸå®çš„DOMèŠ‚ç‚¹(åˆ’é‡ç‚¹: DOMèŠ‚ç‚¹å†…åªæœ‰å­—ç¬¦ä¸²). \båœ¨ReactDOMComponentå½“ä¸­æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ–¹æ³•: 123456789101112131415161718192021222324252627this._createInitialChildren = function(transaction, props, context, lazyTree) { var innerHTML = props.dangerouslySetInnerHTML; if (innerHTML != null) { if (innerHTML.__html != null) { DOMLazyTree.queueHTML(lazyTree, innerHTML.__html); } } else { var contentToUse = CONTENT_TYPES[typeof props.children] ? props.children : null; var childrenToUse = contentToUse != null ? null : props.children; if (contentToUse != null) { if (contentToUse !== '') { DOMLazyTree.queueText(lazyTree, contentToUse); } } else if (childrenToUse != null) { var mountImages = this.mountChildren( childrenToUse, transaction, context, ); for (var i = 0; i &lt; mountImages.length; i++) { DOMLazyTree.queueChild(lazyTree, mountImages[i]); } } }} ç®€å•çš„è§£é‡Šä¸€ä¸‹è¿™æ®µæ–¹æ³•: é¦–å…ˆå…ˆå»åˆ¤æ–­äº†æ˜¯å¦æœ‰å¼ºè¡Œå¡å…¥innerHTMLçš„è¿™ç§åšæ³•, å¾ˆæ˜¾ç„¶å®˜æ–¹æœ¬èº«æ˜¯ä¸æ¨èç”¨æˆ·è¿™æ ·å»ä½¿ç”¨, ä½†æ˜¯åœ¨æŸä¸€äº›çš„ç‰¹å®šåœºæ™¯ä¸‹, å¿…é¡»è¦ç”¨åˆ°è¿™ç§æ–¹æ³•. true, å°±æŠŠ__htmlä½œä¸ºå½“å‰èŠ‚ç‚¹çš„innerHTML. false, ç»§ç»­è¿›è¡Œä¸‹ä¸€æ­¥. \bæ¥ç€å»åˆ¤æ–­å½“å‰çš„childrenæ˜¯å¦æ˜¯CONTENT_TYPESè¿™ä¸ªæšä¸¾ç±»çš„æˆå‘˜. true, é‚£å°±æŠŠchildrenå¡ç»™å½“å‰çš„èŠ‚ç‚¹ä½œä¸ºinnerHTML. false, é‚£ä¹ˆå°±è¯æ˜ç°åœ¨çš„è¿™ä¸ªchildrenå¹¶éæ˜¯ä¸€ä¸ªDOMèŠ‚ç‚¹è€Œæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ç»„ä»¶. \bé‚£å°±ç»§ç»­è°ƒç”¨instantiateReactComponentæ–¹æ³•æ¥å®ä¾‹åŒ–childrenç›´åˆ°æ‰€æœ‰çš„å­èŠ‚ç‚¹è¢«åˆ›å»ºå®Œæˆ.æ³¨æ„: æ­¤å¤„æ˜¯ä¸€ä¸ªé€’å½’è°ƒç”¨çš„è¿‡ç¨‹ åˆ°è¿™ä¸ªåœ°æ–¹, åŸºæœ¬renderæ–¹æ³•çš„è°ƒç”¨å°±ç»“æŸäº†, è°ƒç”¨å®Œæˆçš„ç»“æœå°±æ˜¯ä¸Šé¢å›¾ä¾‹çš„markupå¯¹è±¡. 4) componentDidMountçš„è°ƒç”¨: 123if (inst.componentDidMount) { transaction.getReactMountReady().enqueue(inst.componentDidMount, inst);} åœ¨è¿™é‡ŒReactçš„å¼€å‘è€…ä»¬å¾ˆèªæ˜çš„é‡‡ç”¨äº†ä¸€ä¸ªé˜Ÿåˆ—çš„å½¢å¼, é‡‡ç”¨æ‰¹å¤„ç†çš„æ–¹å¼æ¥è°ƒç”¨componentDidMountçš„æ–¹æ³•.åˆ°è¿™ä¸ªåœ°æ–¹, Reactçš„æŒ‚è½½é˜¶æ®µåŸºæœ¬å°±å·²ç»ç»“æŸäº†. å¯¹äºäº‹åŠ¡å¤„ç†ä»¥åŠäº‹ä»¶æœºåˆ¶è¿˜æœ‰å¯¹è±¡æ± çš„æ¦‚å¿µ, åˆ°åé¢ä¼šå†è¯´åˆ°. 2. å­˜åœ¨é˜¶æ®µ \bå­˜åœ¨é˜¶æ®µä¸»è¦å¯¹åº”çš„ä¸»è¦æ˜¯å¯¹æµè§ˆå™¨äº‹ä»¶çš„ä¸€ä¸ªå“åº”, å› ä¸ºç”¨æˆ·æ“ä½œè€Œè§¦å‘çš„ä¸€ç³»åˆ—æµè§ˆå™¨äº‹ä»¶. \bæ¥ä¸‹æ¥çš„æ›´æ–°éƒ½æ˜¯äº¤äº’åäº§ç”Ÿçš„æ›´æ–°æ“ä½œ, \bæµè§ˆå™¨å“åº”ç›¸åº”çš„äº‹ä»¶æœ€åè¢«setStateæˆ–æ”¹å˜propsè§¦å‘æ›´æ–°. (setStateä¼šåœ¨åé¢ç« èŠ‚è¿›è¡Œè¯¦ç»†çš„ä»‹ç»). ä¸»æ’­å†ä¸æ›´æ–°æˆ‘å°±é€€è®¢! updateComponent (è¿™é‡Œä»¥ReactCompositeComponent [è‡ªå®šä¹‰ç»„ä»¶]ä¸ºä¾‹) 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576var updateComponent = function( transaction, prevParentElement, nextParentElement, prevUnmaskedContext, nextUnmaskedContext, ) { var inst = this._instance; invariant( // å¦‚æœå¯¹å·²ç»è¢«å¸è½½æ‰çš„èŠ‚ç‚¹è°ƒç”¨è¿™ä¸ªæ–¹æ³•åˆ™æŠ›å¼‚å¸¸ inst != null, 'Attempted to update component `%s` that has already been unmounted ' + '(or failed to mount).', this.getName() || 'ReactCompositeComponent', ); var willReceive = false; var nextContext; // æ£€æŸ¥contextä¸Šçš„å€¼æ˜¯å¦ä¸€è‡´ if (this._context === nextUnmaskedContext) { nextContext = inst.context; } else { nextContext = this._processContext(nextUnmaskedContext); willReceive = true; } var prevProps = prevParentElement.props; var nextProps = nextParentElement.props; // å¯¹æ¯”å‰åçš„Elementæ˜¯å¦ç›¸åŒ if (prevParentElement !== nextParentElement) { // æ›´æ–°æ ‡è¯†ç¬¦è®¾ç½®ä¸ºtrue willReceive = true; } if (willReceive &amp;&amp; inst.componentWillReceiveProps) { inst.componentWillReceiveProps(nextProps, nextContext); } var nextState = this._processPendingState(nextProps, nextContext); // æ‹¿åˆ°ä¸‹ä¸€ä¸ªæ—¶é—´çš„state var shouldUpdate = true; if (!this._pendingForceUpdate) { if (inst.shouldComponentUpdate) { shouldUpdate = inst.shouldComponentUpdate(// &lt;- å®ä¾‹shouldComponentUpdateé’©å­è°ƒç”¨ nextProps, nextState, nextContext, ); } else { // å¤„ç†ä¸€ä¸ªPureComponentçš„æ¡ä»¶, å…³äºPureComponentä¸Componentçš„å¯¹æ¯” // å¯ä»¥åœ¨ç»™åˆ°çš„å‡ ä¸ªé“¾æ¥é‡Œå¤šçœ‹çœ‹è¿™é‡Œå°±ä¸å¤šåšè§£é‡Š // https://60devs.com/pure-component-in-react.html // https://stackoverflow.com/questions/41340697/react-component-vs-react-purecomponent if (this._compositeType === CompositeTypes.PureClass) { shouldUpdate = !shallowEqual(prevProps, nextProps) || !shallowEqual(inst.state, nextState); } } } this._updateBatchNumber = null; // ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°shouldUpdateè¿™ä¸ªå€¼é»˜è®¤éƒ½æ˜¯è¢«è®¾ç½®ä¸ºtrueçš„, æ‰€ä»¥åœ¨æ€§èƒ½ä¼˜åŒ–çš„æ—¶å€™, å¯ä»¥è€ƒè™‘ä½¿ç”¨ // shouldComponentUpdateè¿™ä¸ªé’©å­å‡½æ•°æ¥æ§åˆ¶ä¸€ä¸‹é‡ç»˜çš„ç»„ä»¶çš„æ•°é‡æ¥è¾¾åˆ°å‡å°‘é‡ç»˜è°ƒç”¨ä¼˜åŒ–æ€§èƒ½çš„ç›®çš„ if (shouldUpdate) { this._pendingForceUpdate = false; // ä¼ é€’æ–°çš„å±æ€§, çŠ¶æ€, ä¸Šä¸‹æ–‡è¿›è¡Œæ›´æ–° this._performComponentUpdate( nextParentElement, nextProps, nextState, nextContext, transaction, nextUnmaskedContext, ); } else { this._currentElement = nextParentElement; this._context = nextUnmaskedContext; inst.props = nextProps; inst.state = nextState; inst.context = nextContext; } } åœ¨åˆ¤æ–­å®Œéœ€è¦æ›´æ–°è¿™ä¸ªç»“æœä¹‹å, å°±è¦è¿›è¡Œæ¥ä¸‹æ¥çš„performUpdateæ“ä½œ. å¼€å§‹ä½ çš„è¡¨æ¼” performUpdate performUpdateé¡¾åæ€ä¹‰å°±æ˜¯è¦è¿›è¡Œå®é™…çš„æ›´æ–°æ“ä½œäº†, æ›´æ–°æ“ä½œå®é™…ä¸Šå¤§è‡´ä¸åˆå§‹çš„æŒ‚è½½æ“ä½œä¸€è‡´. ä»£ç èµ°ä½ ! 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748_performComponentUpdate: function( nextElement, nextProps, nextState, nextContext, transaction, unmaskedContext,) { var inst = this._instance; var hasComponentDidUpdate = Boolean(inst.componentDidUpdate); var prevProps; var prevState; var prevContext; if (hasComponentDidUpdate) { prevProps = inst.props; prevState = inst.state; prevContext = inst.context; } if (inst.componentWillUpdate) { // ğŸ‘‡ willUpdate é’©å­å‡½æ•°è°ƒç”¨ inst.componentWillUpdate(nextProps, nextState, nextContext); } this._currentElement = nextElement; this._context = unmaskedContext; inst.props = nextProps; inst.state = nextState; inst.context = nextContext; // æŠŠæ›´æ–°ä¼ é€’åˆ°DOMä¸Šå» è¿™è¾¹çš„æ›´æ–°è·ŸæŒ‚è½½æ—¶çš„æ“ä½œå¾ˆç›¸ä¼¼ æ‰€ä»¥å°±ä¸åšå±•å¼€äº†. this._updateRenderedComponent(transaction, unmaskedContext); if (hasComponentDidUpdate) { // è®¾ç½®å¥½æœ€åä¸€ä¸ªæ›´æ–°çš„é’©å­å‡½æ•°, åœ¨äº‹åŠ¡æ“ä½œç»“æŸä¹‹åè°ƒç”¨ transaction .getReactMountReady() .enqueue( inst.componentDidUpdate.bind( inst, prevProps, prevState, prevContext, ), inst, ); }} è‡³äºåœ¨æœ€å, æ€ä¹ˆæŠŠè¿™äº›èŠ‚ç‚¹ç»™åæ˜ åˆ°åˆ°DOMä¸Šå»çš„å‘¢? è¯·çœ‹ä¸‹å›åˆ†è§£. ä¸‹èŠ‚é¢„å‘Š: ä»è™šæ‹ŸDOMåˆ°çœŸå®çš„DOM.","link":"/2018/07/26/Reactæºç é˜…è¯»ç³»åˆ—-Â§2.1-ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹è¯¦è§£/"},{"title":"Rust çš„ç±»å‹ç³»ç»Ÿ","text":"å…³é”®å­—: Rust ç±»å‹ç³»ç»Ÿ Rust çš„ç±»å‹ç³»ç»ŸRust æ˜¯ä¸€é—¨é™æ€ç¼–è¯‘ç±»çš„è¯­è¨€, ç±»å‹ç³»ç»Ÿçš„è®¾è®¡å¯ä»¥å¸®åŠ©ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸå†…å°±å°†â€å®¹æ˜“å‡ºé”™çš„ä»£ç â€æš´éœ²ç»™ç¼–å†™ç¨‹åºçš„äºº. Rust çš„ç±»å‹ç³»ç»Ÿçš„è®¾è®¡ç›®æ ‡æ˜¯: å®‰å…¨æ€§ æ•ˆç‡ ç®€æ´ Rust çš„ç¼–è¯‘å™¨ä¹Ÿä¼šæ ¹æ®ç¨‹åºç¼–å†™è€…ç¼–å†™çš„ä»£ç è‡ªåŠ¨æ¨æ–­å˜é‡çš„ç±»å‹, æ­£å› å¦‚æ­¤, Rust çš„ç¨‹åº\bå¯ä»¥å˜å¾—æ›´åŠ å¹²å‡€. å½“ç„¶, å¹¶ä¸èƒ½è¿‡åˆ†ä¾é è¿™ä¸ªæ¨æ–­ç³»ç»Ÿ, å› ä¸ºè¯¥æŠ¥é”™çš„åœ°æ–¹, ç¼–è¯‘å™¨ä¾æ—§ä¼šæ¯«ä¸ç•™æƒ…åœ°æŠ¥é”™. å…³äºè‡ªåŠ¨æ¨æ–­ç±»å‹å¯ä»¥çœ‹è¿™ä¸ªä¾‹å­:12345678910// ä»£ç æ‘˜æŠ„è‡ª Programming Rust ä¸€ä¹¦fn build_vector() -&gt; Vec&lt;i16&gt; { //&lt;-- æ³¨æ„è¿”å›å€¼// let mut v: Vec&lt;i16&gt; = Vec::&lt;i16&gt;::new(); let mut v = Vec::new();// v.push(10i16);// v.push(20i16); v.push(10); v.push(20); v} ä¸Šé¢è¿™ä¸ªä¾‹å­, ç”±äºå‡½æ•°çš„è¿”å›æ˜¯ v, è€Œè¿”å›å€¼çš„ç±»å‹æ˜¯ Vec&lt;i16&gt;, é‚£ä¹ˆè‡ªç„¶ v ä¼šè¢«æ¨æ–­ä¸º Vec&lt;i16&gt; ç±»å‹. æ‰€ä»¥ v.push(item), item çš„ç±»å‹è‡ªç„¶æ˜¯ i16. æ¯”è¾ƒæ³¨é‡Šå¤„çš„ä»£ç ä¼šæ˜¾å¾—æ›´åŠ ç®€æ´. Rust çš„ç±»å‹ç§ç±»åŸºç¡€ç±»å‹ å†…å­˜å¤§å° (bits) æ— ç¬¦å·æ•´æ•° æœ‰ç¬¦å·æ•´æ•° æµ®ç‚¹æ•° 8 u8 i8 - 16 u16 i16 - 32 u32 i32 f32 64 u64 i64 f64 æœºå™¨å­—é•¿ usize isize - æ³¨: æœºå™¨å­—é•¿æ ¹æ® OS æ”¯æŒçš„ä½æ•°æ¥è‡ªé€‚åº”çš„, å¦‚æœä½ çš„ä»£ç è·‘åœ¨ 32 bit çš„æœºå™¨ä¸Š, é‚£ä¹ˆæœºå™¨å­—é•¿å°±åº”è¯¥ä¸º 32bit, å¯¹åº”çš„ uszie å°±æ˜¯ 32 ä½, ä½†æ˜¯è¦æ³¨æ„å³ä½¿åœ¨ 32 ä½çš„ç”µè„‘ä¸Š, å†…å­˜é‡Œçš„ usize å’Œ u32 çš„å†…å­˜è¡¨ç¤ºæ˜¯ä¸€æ ·çš„, ä½† usize != u32, åœ¨æ‰§è¡Œç‰¹å®šæ“ä½œæ—¶, éœ€è¦å°† usize é€šè¿‡ usize as u32 å¼ºè½¬æˆ u32 ç±»å‹. æ— ç¬¦å·æ•´æ•°æ¯ä¸€ä½éƒ½ç”¨æ¥è¡¨ç¤ºå®ƒçš„å¤§å°. èŒƒå›´ä» 0 - 2size-1. ç¬¦å·æ•´æ•°åœ¨ Rust ä¸­ç”¨ 2 çš„è¡¥ç æ¥è¡¨ç¤º, å› æ­¤ä¹Ÿæ²¡æœ‰ Â±0 çš„é—®é¢˜å­˜åœ¨. èƒ½å¤Ÿè¡¨ç¤ºçš„èŒƒå›´ä¸º [2size - 1, 2 size - 1 -1] æµ®ç‚¹æ•°åœ¨ Rust ä¸­çš„è¡¨ç¤ºéµå¾ªäº† IEEE 754-2008 çš„å•ç²¾åº¦å’ŒåŒç²¾åº¦æµ®ç‚¹æ•°æ ‡å‡†. å­—ç¬¦ç±»å‹åœ¨ Rust ä¸­è¡¨ç¤ºå•ä¸ªæœ‰æ•ˆçš„ Unicode å­—ç¬¦, é•¿åº¦ä¸º 32-bit, char åªèƒ½ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå•ç‹¬çš„ Unicode å­—ç¬¦, ä»¥ '\bç‹¬' å½¢å¼, ä¸ str ç±»å‹ä¸åŒåœ¨äº, char è¡¨ç¤ºçš„å­—ç¬¦è¦ç”¨ å•å¼•å· (') æ¥ä¿®é¥°, è€Œ str ç±»å‹ä½¿ç”¨åŒå¼•å·(&quot;)ä¿®é¥°, ä¹Ÿå¯ä»¥ä½¿ç”¨ '\\u{007F}' çš„æ–¹å¼æ¥è¡¨ç¤ºä¸€ä¸ª char ç±»å‹. å¸ƒå°”ç±»å‹åœ¨ Rust ä¸­ç”¨ true å’Œ false è¡¨ç¤º, åœ¨å†…å­˜ä¸­è¡¨ç¤ºä¸ºä¸€ä¸ªå®Œæ•´çš„å­—èŠ‚ (8-bit), æ‰€ä»¥ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæŒ‡å‘æ”¹åœ°å€çš„æŒ‡é’ˆ. æœ€å¤§çš„æ•°Rust ä¸­ç®—æ•°è¿ç®—å¦‚æœå‘ç”Ÿäº†ä½æº¢å‡ºä¼šè‡´ä½¿æ•´ä¸ªç¨‹åºå´©æºƒ, Rust èƒ½å¤Ÿè¡¨ç¤ºçš„æœ€å¤§çš„æœ‰ç¬¦å·æ•´æ•°å¯ä»¥åœ¨æ ‡å‡†åº“å¯¹åº”çš„ç±»å‹ä¸‹æˆå‘˜std::itype::MAX å¦‚ std::i32::MAX. Byte ç±»å‹å¯¹äºå¾ˆå¤šè¯­è¨€ä¸­å­˜åœ¨çš„ byte ç±»å‹, åœ¨ Rust ä¸­ç”¨ u8 æ¥è¡¨ç¤º, å½“ä» socket å’Œ æ–‡ä»¶ä¸­è¯»å–æ•°æ®æ—¶, éƒ½ä¼šäº§å‡º u8 ç±»å‹çš„å€¼. æ•´æ•°ç±»å‹çš„å­—é¢é‡è¡¨ç¤º12345let suffix = 245u8;let underscore = 222_222u32;let bytes_literal = 0b1111_1111; // u8let float = 0.5; // è‡ªåŠ¨æ¨æ–­ä¸ºf64.let octal = 0o53; Rust è¿˜æä¾›äº†ä¸€ç§æ–¹å¼èƒ½å¤Ÿæ–¹ä¾¿çš„å°† ASCII è½¬æ¢æˆ u8 ç±»å‹çš„å†™æ³•let ascii = b'ASCII';, è¿™æ ·å¯ä»¥æ–¹ä¾¿å¿«æ·åœ°æŠŠ ASCII Code è½¬æ¢æˆä¸€è¿ä¸²çš„äºŒè¿›åˆ¶æ•°. ç±»å‹è½¬æ¢Rust ä¹Ÿåƒ Go, Java è¿™æ ·çš„è¯­è¨€ä¸€æ ·, æä¾›äº†ç±»å‹ä¹‹é—´çš„è½¬æ¢çš„æ–¹æ³•, ä¸è¿‡å…³äº Rust ä¸­çš„ç±»å‹è½¬æ¢, æ­¤å¤„ä¸åšé‡ç‚¹ä»‹ç», ä¼šä¸“é—¨ç•™ä¸€å°èŠ‚æ¥åšé‡ç‚¹ä»‹ç». ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯, ä¸ C, C++ ç­‰è¯­è¨€ä¸åŒçš„åœ°æ–¹æ˜¯, Rust ä¸ä¼šå¯¹å€¼æ“ä½œæ—¶è¿›è¡Œéšå¼è½¬æ¢, å¦‚ç±»å‹ä¸º i32 å’Œ i64 çš„ä¸¤ä¸ªå˜é‡è¿›è¡Œæ¯”è¾ƒæ—¶, å°½ç®¡ i32 çš„å€¼æ°¸è¿œéƒ½æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ i64 çš„å€¼, ä½†å› ä¸ºç±»å‹ä¸åŒ, ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸå°±æŠ›é”™. æ•°ç»„ç±»å‹æ•°ç»„åœ¨ Rust ä¸­çš„è¡¨ç¤ºä¸º [T;N], ä»£è¡¨ä¸€ä¸ªå«æœ‰ N ä¸ª T ç±»å‹çš„é›†åˆ, åœ¨ Rust ä¸­æ•°ç»„æ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„ä¸€ä¸ªç±»å‹, å®ƒåœ¨ç¼–è¯‘æœŸå°±å¯ä»¥åˆ¤å®šæ‰€éœ€è¦å†…å­˜ç©ºé—´çš„å¤§å°: N * size(T). æ•°ç»„ä¸èƒ½å¤Ÿæ·»åŠ å’Œåˆ é™¤æˆå‘˜, ä½†å¯ä»¥æ”¹å˜æˆå‘˜. æ•°ç»„æˆå‘˜è¢«ä¿å­˜åœ¨æ ˆå†…å­˜ä¸­.12let a = [20u8;40]; // æ‹¥æœ‰ 40 ä¸ª å€¼ä¸º 20 çš„æ•°ç»„a.push(20u8); // no method named `push` found for type `[u8; 40]` in the current scope åŠ¨æ€æ•°ç»„ç±»å‹åŠ¨æ€æ•°ç»„ç±»å‹æ˜¯æ ¹æ•°ç»„æœ‰ç€åŒæ ·ä½œç”¨ä½†å†…å­˜æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ†é…çš„, å¹¶ä¸”å¯ä»¥åŠ¨æ€æ·»åŠ , åˆ é™¤æˆå‘˜æ•°ç»„, æ›´æ”¹æ•°ç»„çš„å®¹é‡å¤§å°. \båŠ¨æ€æ•°ç»„çš„æˆå‘˜è¢«ä¿å­˜åœ¨å †å†…å­˜ä¸­. åˆ‡ç‰‡ç±»å‹åˆ‡ç‰‡ç±»å‹æ˜¯å¯¹æ•°ç»„æˆ–è€…åŠ¨æ€æ•°ç»„çš„ä¸€ä¸ªå¼•ç”¨, å†…å­˜ä¸­è¡¨ç°ä¸ºä¸€ä¸ªèƒ–æŒ‡é’ˆ (Fat Pointer), è¿™ä¸ªèƒ–æŒ‡é’ˆç»„æˆå¦‚è¡¨:å­—æ®µå | æè¿°â€”â€”â€”-|â€”â€”â€”â€”pointer | æŒ‡å‘åˆ‡ç‰‡ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆnumber | è¯¥åˆ‡ç‰‡æ‹¥æœ‰å¤šå°‘ä¸ªå…ƒç´  æ•°ç»„, åŠ¨æ€æ•°ç»„, åˆ‡ç‰‡çš„å†…å­˜æ¨¡å‹æ¯”è¾ƒ å›¾ç‰‡æ¥è‡ªäº Programming Rust ä¸€ä¹¦ å­—ç¬¦ä¸²å­—ç¬¦ä¸²å¯ä»¥è¢«è§†ä¸ºä¸€è¿ä¸²çš„ char ç±»å‹çš„ç»„åˆ, å­—ç¬¦ä¸²æœ‰ä¸¤ç§ç±»å‹ str (ä¸å¯å˜, å¯é€šè¿‡ç´¢å¼•è®¿é—®) String (å¯å˜, ä¸å¯é€šè¿‡ç´¢å¼•è®¿é—®) Stringåœ¨å†…å­˜ä¸­çš„è¡¨ç¤º123let noodles = \"noodles\".to_string();let oodles = &amp;noodles[1..];let poodles = \" _ \"; % asset_img å­—ç¬¦ä¸²å†…å­˜æ¨¡å‹.jpg å­—ç¬¦ä¸²å†…å­˜æ¨¡å‹ %} ä»¥ä¸Šæ¥è‡ª Programming Rust ä¸€ä¹¦ String åœ¨å†…å­˜ä¸­æ˜¯é€šè¿‡è¿è¡Œæ—¶åŠ¨æ€åˆ†é…åœ¨å †å†…å­˜ä¸Šçš„, ä½† String åœ¨å †å†…å­˜ä¸Šè¿˜æ˜¯éœ€è¦æœ‰å¯¹åº”çš„è¡¨ç¤ºçš„, å®é™…ä¸Š, String ç±»å‹åœ¨å †å†…å­˜ä¸Šçš„è¡¨ç¤º: å­—æ®µå æè¿° ptr æŒ‡å‘å †å†…å­˜ä¸Šçš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„å†…å­˜åœ°å€ capacity å½“å‰ String çš„å®¹é‡ length å½“å‰ String çš„é•¿åº¦ åœ¨ Rust ä¸­, å­—ç¬¦ä¸²å­—é¢é‡å¦‚: â€œI am some stringâ€ çš„ç±»å‹ä¸º &amp;str, å¹¶ä¸”è¿™ä¸ªå˜é‡çš„ç”Ÿå‘½å‘¨æœŸå’Œç¨‹åºä¸€æ ·é•¿, å½“ç¨‹åºå¯åŠ¨æ—¶è¯¥å­—ç¬¦ä¸²å­—é¢é‡å°±è¢«åˆ›å»ºåœ¨å¸¸é‡æ± ä¸­, å½“ç¨‹åºç»“æŸäº†ä¹‹å, å¸¸é‡æ± é‡Œçš„è¯¥å˜é‡ä¹Ÿå¯¹åº”é”€æ¯. \bè€ŒåŠ¨æ€çš„ String ç”¨æ¥ä¿å­˜ä¸€äº›åŠ¨æ€æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸå¹¶ä¸è·Ÿå­—ç¬¦ä¸²å­—é¢é‡ä¸€æ ·é•¿, è¿™äº›å†…å­˜è¢«åŠ¨æ€åˆ†é…. æŒ‡é’ˆç±»å‹Rust å’Œ C/C++ ä¸€æ ·, æ‹¥æœ‰æŒ‡é’ˆç±»å‹, ä¸è¿‡ Rust çš„æŒ‡é’ˆç±»å‹åˆ†ä¸ºå¼•ç”¨æŒ‡é’ˆå’Œè£¸æŒ‡é’ˆ. å¼•ç”¨æŒ‡é’ˆé€šè¿‡ &amp; æ“ä½œç¬¦å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆ, æŒ‡å‘å¯¹åº”çš„å˜é‡.123let a = 20u32;let ptr = &amp;a;println!(\"{:p}\", ptr); // 0x7fff304b5774 ä½†æ˜¯, è™½ç„¶è¿™æ ·å°±å¯ä»¥ç›´æ¥åˆ›å»ºæŒ‡é’ˆ, ä½†æ˜¯è¦ä¸Šä¾‹çš„æŒ‡é’ˆæŒ‡å‘çš„æ˜¯æ ˆä¸­çš„å˜é‡è€Œä¸æ˜¯å †ä¸­çš„å˜é‡, å¾ˆå¤šæ—¶å€™ç”±äºæ ˆçš„ç©ºé—´æœ‰é™åˆ¶, ä¼šå€¾å‘äºé€‰æ‹©åœ¨å †ä¸Šåˆ›å»ºå˜é‡å¹¶å»ºç«‹æŒ‡é’ˆæŒ‡å‘è¿™ä¸ªå˜é‡, å¦‚åŠ¨æ€æ•°ç»„, å­—ç¬¦ä¸²ä¸­ä¾¿æœ‰ä¸€ä¸ªä¿å­˜å½“å‰æŒ‡é’ˆçš„å­—æ®µ. ç›’ç±»å‹é€šè¿‡ Rust æ ‡å‡†åº“ä¸­æä¾›çš„ Box ç±»å‹, å¯ä»¥éå¸¸æ–¹ä¾¿åœ°åœ¨å †å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªå˜é‡, ç±»å‹ä¸º Box&lt;T&gt;.1let heap = Box::new(20u32); // Boxed value, è¿™æ ·å°±åœ¨å †ä¸Šåˆ›å»ºäº†ä¸€ä¸ª u32 ç±»å‹çš„å˜é‡ è£¸æŒ‡é’ˆRust ä¸­çš„è£¸æŒ‡é’ˆå°±å’Œ C/C++ ä¸­çš„æŒ‡é’ˆç±»å‹ä¸€æ ·, æ‹¥æœ‰åŒæ ·çš„åŠŸèƒ½. å¼ ç¿å› å¦‚æ­¤, é‡æŒ‡é’ˆç”±äºä¸å¯æ§, ä¹Ÿå¯èƒ½å‡ºç°ç©ºæŒ‡é’ˆçš„é—®é¢˜. å¤åˆç±»å‹å…ƒç»„å…ƒç»„åœ¨ Rust ä¸­çš„ä½œç”¨å’Œè¡¨ç°è·Ÿå…¶ä»–è¯­è¨€å¦‚: Python ä¸­ä¸€æ ·, è¡¨ç¤ºä¸€ä¸ªæœ‰åºçš„â€æ•°ç»„â€, å’Œæ•°ç»„ä¸ä¸€æ ·, å…ƒç»„çš„æ¯ä¸€ä¸ªå…ƒç´ å¯ä»¥æ‹¥æœ‰ä¸åŒçš„ç±»å‹.123let tuple = (1u32, 2u32, 3u32);println!(\"{:?}\", tuple.0); // ç”¨ tuple.index æ–¹å¼æ¥è®¿é—®æˆå‘˜let (a, b, c) = tuple; // tuple ç±»çš„è§£æ„ åœ¨å†…å­˜ä¸­è¡¨ç°ä¸ºä¸€æ®µè¿ç»­çš„ä¸åŒç±»å‹å†…å­˜çš„ç»„åˆ, å¯ä»¥é€šè¿‡å…ƒç´ çš„ä½ç½®æ¥è®¿é—®.å¹¶ä¸” tuple å¯ä»¥é€šè¿‡è§£æ„æ¥å–å¾—é‡Œé¢çš„å…ƒç´ . ç»“æ„ä½“ç»“æ„ä½“ (Struct) è·Ÿå…¶ä»– OOP ä¸­çš„ class æœ‰äº›ç›¸ä¼¼, ç”¨æ¥æè¿°ä¸€ç³»åˆ—ç±»å‹çš„ç»„åˆ, æŠŠè¿™äº›ç±»å‹èšåˆåœ¨ä¸€èµ·, ä¾¿æˆäº†ä¸€ä¸ªç»“æ„ä½“.ç»“æ„ä½“å¯ä»¥å¤§è‡´åˆ’åˆ†ä¸ºä¸¤ç§, ä¸€ç§å°±æ˜¯æœ€æ™®é€šçš„ç»“æ„ä½“, ä¸€ç§æ˜¯å…ƒç»„ç±»ç»“æ„ä½“123456struct Point { x: u32, y: u32};struct IPv4(u8, u8, u8, u8); æšä¸¾Rust ä¸­çš„æšä¸¾ç±»å’Œ C ä¸­çš„æšä¸¾ç±»å¾ˆç›¸ä¼¼, å¹¶ä¸”æœ‰æ›´åŠ å¼ºå¤§çš„åŠŸèƒ½, Rust çš„æšä¸¾æˆå‘˜èƒ½å¤ŸåŒ…å«éœ€è¦çš„ä¿¡æ¯, å¹¶ä¸”è¿˜å¯ä»¥åœ¨æšä¸¾ç±»ä¸Šå®ç°æ–¹æ³•.","link":"/2019/03/10/Rustçš„ç±»å‹ç³»ç»Ÿ/"}],"tags":[{"name":"react16.x æºç é€†å‘","slug":"react16-x-æºç é€†å‘","link":"/tags/react16-x-æºç é€†å‘/"},{"name":"Reactæºç é˜…è¯»","slug":"Reactæºç é˜…è¯»","link":"/tags/Reactæºç é˜…è¯»/"},{"name":"Rust","slug":"Rust","link":"/tags/Rust/"}],"categories":[{"name":"React16é€†å‘ç³»åˆ—","slug":"React16é€†å‘ç³»åˆ—","link":"/categories/React16é€†å‘ç³»åˆ—/"},{"name":"Reactæºç é˜…è¯»ç³»åˆ—","slug":"Reactæºç é˜…è¯»ç³»åˆ—","link":"/categories/Reactæºç é˜…è¯»ç³»åˆ—/"},{"name":"Rust lang","slug":"Rust-lang","link":"/categories/Rust-lang/"}]}